<!--Extends the base.html file that includes different imports and the navbar-->
{% extends 'matistikk/base.html' %}
<!--Loads the tag library-->
{% load bootstrap3 %}
<!--Loads the staticfiles-->
{% load staticfiles %}
<!-- Loads CSS and javascript--
{% bootstrap_css %}
{% bootstrap_javascript %}
<!--Display django.contrib.messages as Bootstrap alerts-->
{% bootstrap_messages %}
{% block head %}
    <!--Imports geogebra-->
    <script type="text/javascript" src="{% static 'maths/js/deployggb.js' %}"></script>
    <!--Imports bootstrap select css-->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/css/bootstrap-select.min.css">
    <!--Imports bootstrap select-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/js/bootstrap-select.min.js"></script>
    <!--Imports bootstrap select-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/js/i18n/defaults-*.min.js"></script>
    <!--Imports bootbox-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.min.js"></script>
    <!--Imports Tinymce-->
    <script type="text/javascript" src="{% static 'tinymce/js/tinymce/tinymce.min.js' %}"></script>
    <!--Imports mathquill-->
    <script type="text/javascript"
            src="{% static 'tinymce/js/tinymce/plugins/equationeditor/mathquill.min.js' %}"></script>
    <script>
        var configurl = '{% static 'tinymce/js/tinymce/plugins/equationeditor/config.json' %}';
        tinymce.PluginManager.load('equationeditor', "{% static 'tinymce/js/tinymce/plugins/equationeditor/plugin.min.js'%}");

        tinymce.init({
            selector: '#tasktext',
            plugins: 'equationeditor  textcolor lists fullscreen autolink link tabfocus table ',
            content_css: '{% static 'tinymce/js/tinymce/plugins/equationeditor/mathquill.css'%}',
            toolbar: [
                'bold italic underline fontsizeselect | forecolor bullist numlist | subscript superscript equationeditor link table | fullscreen '
            ],
            statusbar: false,
            fontsize_formats: '8pt 10pt 12pt 14pt 18pt',
            menubar: false
        });
        tinymce.init({
            selector: '#previewtasktext',
            plugins: 'placeholder',
            content_css: '{% static 'tinymce/js/tinymce/plugins/equationeditor/mathquill.css'%}',
            toolbar: false,
            menubar: false,
            statusbar: false,
            readonly: 1,
            body_id: 'tasktextID'
        });
        tinymce.init({
            selector: '#variableDescription',
            plugins: 'equationeditor  textcolor lists fullscreen autolink link tabfocus table placeholder',
            content_css: '{% static 'tinymce/js/tinymce/plugins/equationeditor/mathquill.css'%}',
            toolbar: [
                'bold italic underline fontsizeselect | forecolor bullist numlist | subscript superscript equationeditor link table | fullscreen '
            ],
            statusbar: false,
            fontsize_formats: '8pt 10pt 12pt 14pt 18pt',
            menubar: false,
            height: '250px',
            width: '100%'
        });

    </script>

{% endblock %}


{% block body %}
    <div class="panel panel-info">
        <div class="panel-heading">
            <h2>Lag Oppgave</h2>
        </div>
        <div class="panel-body">
            <div class="col-md-5">
                <label for="taskname">Oppgavenavn</label>
                <div class="input-group">
                    <span class="input-group-addon"><i class="fa fa-tasks"></i></span>
                    <input type="text" class="form-control input-lg" id="taskname" placeholder="Oppgavenavn" autofocus>
                </div>
                <label for="choosetype">Velg kategori</label><br>
                <div class="input-group">
                    <select id="choosetype" class="selectpicker form-control" multiple data-noneSelectedText="test">
                        {% for category in categories %}
                            <option value="{{ category.id }}">{{ category }}</option>
                        {% endfor %}
                    </select>
                    <span class="input-group-btn">
                        <button class="btn btn-warning" type="button" data-toggle="modal" id="addCategoryBtn"
                                data-target="#addCategory"><i
                                class="fa fa-plus"></i></button>
                    </span>
                </div>
                <div class="form-group">
                    <label for="tasktext">Oppgavetekst</label>
                    <textarea class="form-control" id="tasktext" rows="6" style="resize:vertical"
                              placeholder="Skriv oppgavetekst her..."></textarea>

                </div>
                <label for="accordion">Velg svartype</label>
                <div id="accordion" class="panel-group" role="tablist">
                    <div class="panel panel-default" id="tekstRadio">
                        <div class=" panel-heading" role="tab">
                            <h4 class="panel-title">
                                <label style="cursor: pointer"><input type="radio" name="answer_type" value="1"
                                                                      data-toggle="collapse"
                                                                      data-parent="#accordion" data-target="#collapse5"
                                                                      onclick="radioClick(this)" required
                                                                      id="textAnswerRadio">
                                    Tekstsvar</label>
                            </h4>
                        </div>
                        <div id="collapse5" class="panel-collapse collapse">
                            <div class="panel-body">
                                Hvis dette alternativet velges, vil eleven svare med tekst.
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default" id="flervalgExtraRadio">
                        <div class=" panel-heading" role="tab">
                            <h4 class="panel-title">
                                <label style="cursor: pointer"><input type="radio" name="answer_type" value="2"
                                                                      data-toggle="collapse" data-target="#collapse8"
                                                                      data-parent="#accordion"
                                                                      onclick="radioClick(this)" required
                                                                      id="textMutipleRadio">
                                    Flervalgstest</label>
                            </h4>
                        </div>
                        <div id="collapse8" class="panel-collapse collapse">
                            <div class="panel-body">
                                Legg til dine flervalgsspørsmål i modalen som åpner seg.
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default" id="geoRadio">
                        <div class=" panel-heading" role="tab">
                            <p class="panel-title">
                                <label style="cursor: pointer"><input type="radio" name="answer_type" value="3"
                                                                      data-toggle="collapse"
                                                                      data-parent="#accordion" data-target="#collapse7"
                                                                      onclick="radioClick(this)"> Kun tillegg</label>
                            </p>
                        </div>
                        <div id="collapse7" class="panel-collapse collapse">
                            <div class="panel-body">
                                Hvis dette alternativet velges, vil eleven kunne svare kun med tillegg.
                            </div>
                        </div>
                    </div>
                </div>
                <ul class="list-group">
                    <li class="list-group-item">
                        Felt for begrunnelse
                        <div class="material-switch pull-right">
                            <input id="reasoning" name="reasoning1" type="checkbox"/>
                            <label for="reasoning" class="label-success"></label>
                        </div>
                    </li>
                    <li class="list-group-item">
                        Bruk tillegg (Geogebra, puslespill, rekkefølge etc..)
                        <div class="material-switch pull-right" id="extraField">
                            <input id="extra" name="extra1" type="checkbox" checked/>
                            <label for="extra" class="label-success"></label>
                        </div>
                    </li>
                </ul>
                <div id="feedback">

                </div>

            </div>
            <div class="col-md-4 form-margin" id="extradiv">
                <label for="choosetask">Velg oppgavetype</label>
                <select class="form-control input-lg" id="choosetask">
                    <option>Geogebra</option>
                    <option>Velg riktig</option>
                    <option>Rekkefølge</option>
                </select>
                <div id="applet_container"></div>
                <form class="form-horizontal form-margin hidden" action="" method="POST"
                      enctype="multipart/form-data">
                    {% csrf_token %}
                    {% bootstrap_form form %}
                    <button type="submit" id="submitbutton" class="btn btn-success">
                        {% bootstrap_icon "check" %} Lagre
                    </button>
                </form>
            </div>

        </div>
        <div class="panel-footer">
            <div class="btn-group" role="group" aria-label="...">
                <button type="button" onclick="onSubmit()" class="btn btn-success" id="saveTaskBtn"><span
                        class="glyphicon glyphicon-check"
                        aria-hidden="true"></span> Lagre Oppgave
                </button>
                <button type="button" class="btn btn-warning" data-toggle="modal" href="#previewTaskModal"><span
                        class="glyphicon glyphicon-eye-open"
                        aria-hidden="true"></span> Forhåndsvis
                </button>
            </div>
            <div class="btn-group pull-right" role="group" aria-label="...">
                <button class="btn btn-primary" data-toggle="modal" href="#geogebraSettings"><i class="fa fa-sliders"
                                                                                                aria-hidden="true"></i>
                    </span> Innstillinger for GeoGebra
                </button>
                <button class="btn btn-primary variable"><span
                        class="glyphicon glyphicon-blackboard"
                        aria-hidden="true">
                </span> Legg til variabler
                </button>
            </div>
        </div>
    </div>

    <script>

        var viewPortWidth = 1200;
        var viewPortHeight = 750;
        if (typeof window.innerWidth != 'undefined' && window.innerWidth > 1000) {
            viewPortWidth = window.innerWidth * 0.49;
            viewPortHeight = window.innerHeight * 0.7;
        }
        var parameters = {
            "id": "ggbApplet",
            "width": viewPortWidth,
            "height": viewPortHeight,
            "preventFocus": true,
            "language": "nb",
            "showToolBar": true,
            "borderColor": null,
            "showMenuBar": true,
            "allowStyleBar": true,
            "showAlgebraInput": true,
            "enableLabelDrags": false,
            "enableShiftDragZoom": true,
            "capturingThreshold": null,
            "showToolBarHelp": false,
            "errorDialogsActive": true,
            "showTutorialLink": false,
            "showLogging": false,
            "useBrowserForJS": false
        };

        // Applet som inneholder GeoGebra-vinduet som lastes inn i createfunctiontask.jsp
        var applet = new GGBApplet(parameters, '5.0', 'applet_container');
        applet.setPreviewImage('http://bildr.no/image/cEtUd3R6.jpeg', 'https://www.geogebra.org/images/GeoGebra_loading.png?v=1490705653', 'https://www.geogebra.org/images/applet_play.png?v=1490705653');
        //  when used with Math Apps Bundle, uncomment this:
        applet.setHTML5CodebaseVersion('5.0');
        applet.setJNLPBaseDir('https://www.geogebra.org/webstart/');

        // Metoden benyttes til å legge GeoGebra med forhåndsvalgt konfigurasjon inn i en applet
        window.onload = function () {
            applet.inject('applet_container', 'preferhtml5');

        };
    </script>

    <script>
        var variableCount;
        $('.selectpicker').selectpicker({
            noneSelectedText: 'Velg kategori'
        });

        /**
         * This function changes the visibility of the extra-div when the user
         * changes the boolean value of the "Use extra"-switch.
         */
        $('#extra').change(function () {
            if (document.getElementById('extra').checked) {
                $('#extradiv').show();
                $('.variable').removeClass('hidden');
            }
            else {
                $('#extradiv').hide();
                $('.variable').addClass('hidden');
            }
        });

        $('.variable').click(function () {
            var variabelInputField = $('#id_variables');
            if (!variabelInputField.val()) {
                $('.variabelFormGroup').remove();
                variableCount = ggbApplet.getValue('matistikkAntall');
                if (variableCount == "0") {
                    $('#variabelForm').append('<h3 class="variabelFormGroup">Ingen variable ble funnet.</h3>');
                }
                for (var i = 1; i <= parseInt(variableCount); i++) {
                    $('#variabelForm').append("<div class='form-group variabelFormGroup'><label for='matistikkParameter" + i + "'>Parameter " + i + ":</label> <input type='text' placeholder='Skriv inn verdien for parameter " + i + "' class='form-control' id='matistikkParameter" + i + "'required></div>");
                    $('#matistikkParameter' + i).val(ggbApplet.getValue('matistikkParameter' + i));
                }
                $('#variabelForm').append('<button type="submit" class="btn btn-success variabelFormGroup"><i class="fa fa-floppy-o"aria-hidden="true"></i>Sett inn parameter</button>');
            }
            $('#addVariablesModal').modal('show');
        });

        function AddQuestion() {
            $('#removeQuestionBtn').prop('disabled', false);
            var questionDiv = $('#addMultipleChocice .modal-body .multiplechoice');
            var numQuestions = questionDiv.length;
            var ModalBody = $('#addMultipleChocice .modal-body');
            var nextQuestion = parseInt(numQuestions + 1);
            ModalBody.append('<div id="MutipleChoice' + nextQuestion + '" class="multiplechoice"><div><div class="form-group">' +
                '<label for="question' + nextQuestion + '">Spørsmål:</label> <input type="text" class="form-control" id="question' + nextQuestion + '"' +
                'placeholder="Skriv inn spørsmålet"></div><div class="row"><div id="choicesDiv' + nextQuestion + '" class="col-md-10">' +
                '<label class="checkbox-inline"><input type="checkbox" value="' + nextQuestion + '"><input type="text" placeholder="Alternativ 1"></label> ' +
                '<label class="checkbox-inline"><input type="checkbox" value="' + nextQuestion + '"><input type="text" placeholder="Alternativ 2"></label>' +
                '<label class="checkbox-inline"><input type="checkbox" value="' + nextQuestion + '"><input type="text" placeholder="Alternativ 3"></label> ' +
                '</div><div class="col-md-2" id="choicesBtn' + nextQuestion + '"> <button style = "margin-right:4px;" class="btn btn-primary btn-sm border-radius" onclick="AddChoice(' + nextQuestion + ')">Legg til alternativ</button>' +
                '<button class="btn btn-danger btn-sm border-radius" onclick="RemoveChoice(' + nextQuestion + ')">Fjern alternativ</button></div></div>' +
                '<div id="radioOrCheck' + nextQuestion + '" style="margin-top: 10px;" class="hidden"> <label class="radio-inline"><input type="radio" value="radio" name="radio' + nextQuestion + '" checked>Radio</label>' +
                '<label class="radio-inline"><input type="radio" value="check" name="radio' + nextQuestion + '">Checkbox</label></div></div><hr></div>');
        }

        function RemoveQuestion() {
            var questionDiv = $('#addMultipleChocice .modal-body .multiplechoice');
            var numQuestions = questionDiv.length;
            var lastQuestion = parseInt(numQuestions);
            $('#MutipleChoice' + lastQuestion).remove();
            if (numQuestions <= 2) {
                $('#removeQuestionBtn').prop('disabled', true);
            }
        }

        function AddChoice(num, btn) {
            var numChoices = $('#choicesDiv' + num + ' :input[type=checkbox]').length + 1;
            $('#choicesDiv' + num).append('<label class="checkbox-inline"><input type="checkbox" value="' + num + '"><input type="text" placeholder="Alternativ ' + numChoices + '"></label>');
            if (numChoices >= 6) {
                $('#choicesBtn' + num + ' .btn').first().prop('disabled', true);
            } else if (numChoices > 2) {
                $('#choicesBtn' + num + ' .btn').last().prop('disabled', false);
            }
        }

        function RemoveChoice(num, btn) {
            $('#choicesDiv' + num + ' .checkbox-inline').last().remove();
            var numChoices = $('#choicesDiv' + num + ' :input[type=checkbox]').length - 1;
            if (numChoices < 2) {
                $('#choicesBtn' + num + ' .btn').last().prop('disabled', true);
            } else if (numChoices < 6) {
                $('#choicesBtn' + num + ' .btn').first().prop('disabled', false);

            }
        }

        /**
         * This function changes the color of the "choose answertype"-panel
         * when the user change option.
         */
        function radioClick(myRadio) {
            var valg = myRadio.value;
            if (valg == 1) {
                document.getElementById('tekstRadio').className = "panel panel-success";
                document.getElementById('geoRadio').className = "panel panel-default";
                document.getElementById('flervalgExtraRadio').className = "panel panel-default";
            } else if (valg == 2) {
                document.getElementById('tekstRadio').className = "panel panel-default";
                document.getElementById('geoRadio').className = "panel panel-default";
                document.getElementById('flervalgExtraRadio').className = "panel panel-success";
                $('#addMultipleChocice').modal('show');
            } else {
                document.getElementById('tekstRadio').className = "panel panel-default";
                document.getElementById('geoRadio').className = "panel panel-success";
                document.getElementById('flervalgExtraRadio').className = "panel panel-default";

            }
        }

        /**
         * This function parse data from custom input fields into the hidden django-form
         * and clicks the submit-button in the django-form when its done.
         */
        var submit = false;
        function onSubmit() {
            if (submit) {
                return 0;
            }
            var taskname1 = document.getElementById('taskname');
            var taskname2 = document.getElementById('id_title');
            var tasktext1 = tinyMCE.get('tasktext').getContent();
            var tasktext2 = document.getElementById('id_text');
            var variableDescription = tinyMCE.get('variableDescription').getContent();
            $('#id_variableDescription').val(variableDescription);
            var reasoning1 = document.getElementById('reasoning');
            var reasoning2 = document.getElementById('id_reasoning');
            var extra1 = document.getElementById('extra');
            var extra2 = document.getElementById('id_extra');
            var answertype1 = $("input[type='radio'][name='answer_type']:checked").val();
            var answertype2 = document.getElementById('id_answertype');
            var options = document.getElementById('id_options');
            var categoryselect1 = document.getElementById('choosetype');
            var categoryselect2 = document.getElementById('id_category');
            var base64 = document.getElementById('id_base64');
            var preview = document.getElementById('id_preview');
            var feedback = document.getElementById('feedback');

            taskname2.value = taskname1.value;
            tasktext2.value = tasktext1;
            if (taskname1.value == null || taskname1.value == "") {
                feedback.innerHTML = '<div class="alert alert-danger alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Oops!</strong> Du må legge til et oppgavenavn før du sender inn oppgaven </div>';
                return 0;
            }
            answertype2.value = answertype1;
            if (answertype1 == null) {
                feedback.innerHTML = '<div class="alert alert-danger alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Oops!</strong> Du må velge en svartype før du sender inn oppgaven </div>';
                return 0;
            }

            if (reasoning1.checked) {
                reasoning2.checked = true;
            }
            else {
                reasoning2.checked = false;
            }

            if (extra1.checked) {
                extra2.checked = true;
                base64.value = ggbApplet.getBase64();
                preview.value = ggbApplet.getPNGBase64(1, false);
                $('#id_height').val(viewPortHeight);
                $('#id_width').val(viewPortWidth);
            }
            else {
                extra2.checked = false;
            }

            if (answertype1 == 2) {
                var correct = document.getElementById('id_correct');
                var questionsField = document.getElementById('id_questions');
                var radioOrCheck = document.getElementById('id_radioOrCheck');
                var questionDiv = $('#addMultipleChocice .modal-body .multiplechoice');
                var numQuestions = questionDiv.length;

                for (var i = 1; i <= numQuestions; i++) {
                    var fields = $("#MutipleChoice" + i + " :input[type=text]");
                    var question = fields.first().val();
                    questionsField.value += question + '|||||';
                    var choices = fields.slice(1);
                    var breakFunction = false;
                    choices.each(function () {
                        if ($(this).val()) {
                            options.value += $(this).val() + '|||||';
                        } else {
                            breakFunction = true;
                        }
                    });
                    var checked = $("#MutipleChoice" + i + " :checkbox:checked");
                    if (checked.length == 1) {
                        var type = $('input[name=radio' + i + ']:checked', '#radioOrCheck' + i).val();
                        if (type == 'radio') {
                            radioOrCheck.value += false + '|||||';
                        } else {
                            radioOrCheck.value += true + '|||||';
                        }
                    } else {
                        radioOrCheck.value += true + '|||||';
                    }
                    if (breakFunction) {
                        $('#multipleChoiceWarning').removeClass('hidden');
                        $("#multipleChoiceWarning").fadeTo(5000, 500).slideUp(500, function () {
                            $('#multipleChoiceWarning').slideUp(500);
                        });
                        $('#addMultipleChocice').modal('show');
                        return 0;
                    }
                    $("#MutipleChoice" + i + " :input[type=checkbox]").each(function () {
                        correct.value += $(this).is(':checked') + '|||||'
                    });
                    options.value = options.value.slice(0, -5);
                    correct.value = correct.value.slice(0, -5);
                    options.value += '<--->';
                    correct.value += '<--->';
                }
                radioOrCheck.value = radioOrCheck.value.slice(0, -5);
                options.value = options.value.slice(0, -5);
                correct.value = correct.value.slice(0, -5);
                questionsField.value = questionsField.value.slice(0, -5);
            }
            var z = categoryselect1.length;
            var categoryflag = false;
            for (var y = 0; y < z; y++) {
                if (categoryselect1.options[y].selected) {
                    categoryselect2.options[y].selected = true;
                    categoryflag = true;
                }
                else {
                    categoryselect2.options[y].selected = false;
                }
            }

            if (categoryflag == false) {
                feedback.innerHTML = '<div class="alert alert-danger alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Oops!</strong> Du må velge minst en kategori før du sender inn oppgaven </div>';
                return 0;
            }

            document.getElementById('submitbutton').click();
            submit = true;
        }

        $('#reasoning').change(function () {
            if (document.getElementById('reasoning').checked) {
                var reasoningTextField = $('#id_reasoningText');
                reasoningTextField.val("");
                bootbox.prompt({
                    title: "Skriv inn tittel for begrunnelsesfeltet.",
                    placeholder: 'Begrunnelse!',
                    value: $('#taskTitle').text(),
                    buttons: {
                        cancel: {
                            label: '<i class="fa fa-times"></i> Avbryt'
                        },
                        confirm: {
                            label: '<i class="fa fa-check"></i> Lagre'
                        }
                    },
                    callback: function (result) {
                        if (result) {
                            reasoningTextField.val(result);
                        }
                    }
                });
            }
        });
    </script>

    <script>
        $(document).ready(function () {
            $('#variabelForm').submit(function (e) {
                e.preventDefault();
                var variabelInputField = $('#id_variables');
                variabelInputField.val("");
                for (var i = 1; i <= parseInt(variableCount); i++) {
                    var input = $('#matistikkParameter' + i).val();
                    var prevValue = variabelInputField.val();
                    variabelInputField.val(prevValue + input + "|||||");
                    var random = input.split('--->');
                    if (random.length > 1) {
                        var min = parseFloat(random[0]);
                        var max = parseFloat(random[1]);
                        input = Math.floor(Math.random() * (max - min + 1) + min);
                        if (random.length === 3) {
                            var increment = parseFloat(random[2]);
                            var newMax = max / increment;
                            var newMin = min / increment;
                            var x = parseFloat(Math.floor(Math.random() * (newMax - newMin + 1) + newMin));
                            input = (x * increment);
                        }
                    }
                    ggbApplet.setValue("matistikkParameter" + i, input);
                }
                var finalInput = variabelInputField.val();
                variabelInputField.val(finalInput.slice(0, -5));
                $('#addVariablesModal').modal('hide');
            });
            /**
             * This function prevents the default submit routine and sends a ajax Post request to create the
             * new category instead.
             *
             */
            $('#categoryForm').submit(function (e) {
                e.preventDefault();
                var category = $.trim($('#id_category_title').val());
                $.ajax({
                    type: 'POST',
                    url: '{% url 'maths:categoryCreate' %}',
                    data: {
                        'category': category,
                        'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()
                    },
                    dataType: 'json',
                    success: function (data) {
                        $('#addCategory').modal('hide');
                        $('#id_category')
                            .append($("<option></option>")
                                .attr("value", data.category_id)
                                .text(category));
                        $('#id_category option[value=' + data.category_id + ']').attr('selected', true);
                        $('#choosetype')
                            .append($("<option></option>")
                                .attr("value", data.category_id)
                                .text(category));
                        $('#choosetype option[value=' + data.category_id + ']').attr('selected', 'selected');
                        $('.selectpicker').selectpicker('refresh');
                        $('#id_category_title').val("");
                    },
                    error: function (xhr) {
                        alert('error');
                    }
                });
            });
        });
    </script>
{% endblock %}
{% block modal %}
    <!-- Modal -->
    <div class="modal fade" id="geogebraSettings" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header" style="background-color: whitesmoke">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title text-center" id="myModalLabel">Innstillinger for GeoGebra</h4>
                </div>
                <div class="modal-body">
                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th>Valgt</th>
                            <th>Navn</th>
                            <th>Beskrivelse</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>
                                <div class="material-switch">
                                    <input id="showMenuBar" class="settings" name="showMenuBar" type="checkbox"/>
                                    <label for="showMenuBar" class="label-success"></label>
                                </div>
                            </td>
                            <td>showMenuBar</td>
                            <td>States whether the menubar of GeoGebra should be shown in the applet.</td>
                        </tr>
                        <tr>
                            <td>
                                <div class="material-switch">
                                    <input id="enableLabelDrags" class="settings" name="enableLabelDrags"
                                           type="checkbox" checked/>
                                    <label for="enableLabelDrags" class="label-success"></label>
                                </div>
                            </td>
                            <td>enableLabelDrags</td>
                            <td>States whether labels can be dragged.</td>
                        </tr>
                        <tr>
                            <td>
                                <div class="material-switch">
                                    <input id="enableShiftDragZoom" class="settings" name="enableShiftDragZoom"
                                           type="checkbox" checked/>
                                    <label for="enableShiftDragZoom" class="label-success"></label>
                                </div>
                            </td>
                            <td>enableShiftDragZoom</td>
                            <td>States whether the drawing pad should be moveable.</td>
                        </tr>
                        <tr>
                            <td>
                                <div class="material-switch">
                                    <input id="enableRightClick" class="settings" name="enableRightClick"
                                           type="checkbox" checked/>
                                    <label for="enableRightClick" class="label-success"></label>
                                </div>
                            </td>
                            <td>enableRightClick</td>
                            <td>States whether right clicks should be handled by the applet. Setting this parameter to
                                "false" disables context menus, properties dialogs and right-click-zooming.
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Lukk</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="addCategory" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Opprett ny kategori</h4>
                </div>
                <div class="modal-body">
                    <form id="categoryForm" class="form-horizontal form-margin" action="" method="POST"
                          enctype="multipart/form-data">
                        {% csrf_token %}
                        {% bootstrap_form categoryForm %}
                        {% buttons %}
                            <button type="submit" class="btn btn-success" id="saveCategoryBtn">
                                {% bootstrap_icon "check" %} Lagre
                            </button>
                        {% endbuttons %}
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Lukk</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="addVariablesModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header" style="background-color: whitesmoke">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h3 class="modal-title text-center" id="myModalLabel">Legg til variabler</h3>
                </div>
                <div class="modal-body">
                    <div class="text-center">
                        <nav aria-label="Page navigation">
                            <ul class="pagination" style="margin: 0;">
                                <li class="active"><a href="#setVariable" data-toggle="tab">Velg variable</a></li>
                                <li><a href="#description" data-toggle="tab">Beskrivelse</a></li>
                            </ul>
                        </nav>
                    </div>
                    <div class="tab-content" id="tabs">
                        <div class="tab-pane active" id="setVariable">
                            <form id="variabelForm">
                            </form>
                        </div>
                        <div class="tab-pane" id="description">
                            <div class="col-md-10 col-centered">
                                <form id="descriptionForm" style="margin-top: 15px;">
                                    <textarea id="variableDescription"
                                              placeholder="Legg til en beskrivelse av variablene i denne oppgaven."></textarea>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Lukk</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="previewTaskModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" style="width: 95%" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Forhåndsvis oppgave</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-3 hidden" id="notGeogebraDiv"></div>
                        <div class="col-sm-6" id="geogebradiv">
                            <img id='previewbilde' alt='' width="100%"/>
                        </div>
                        <div class="col-sm-6">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h4><span id="previewtasktext"></span></h4>
                                </div>
                                <div class="panel-body">
                                    <div id="textanswerdiv">
                                        <label for="answer">Tekstsvar</label>
                                        <textarea class="form-control" id="previewanswer" rows="6"
                                                  style="resize:vertical"
                                                  placeholder="Skriv svaret ditt her..."></textarea>
                                    </div>

                                    <div id="multiplechoicediv">
                                    </div>

                                    <div id="reasoningdiv">
                                        <label for="reasoning" id="reasoningText">Begrunnelse</label>
                                        <textarea class="form-control" id="previewreasoning" rows="6"
                                                  style="resize:vertical"
                                                  placeholder="Begrunn svaret ditt..."></textarea>
                                    </div>

                                </div>
                                <div class="panel-footer">
                                    <button type="button" class="btn btn-success">Svar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="addMultipleChocice" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-lg" role="document" style="width: 80vw;">
            <div class="modal-content">
                <div class="modal-header" style="background-color: whitesmoke">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h3 class="modal-title text-center" id="myModalLabel">Flervalgsspørsmål</h3> <h5
                        class="text-center">Velg alternativet som er korrekt</h5>
                </div>
                <div class="modal-body">
                    <div id="multipleChoiceWarning" class="alert alert-danger hidden">
                        <strong>Tomt alternativ!</strong> Oppgaven kan ikke ha tomme svaralternativ. Vennligst fyll ut
                        alle felter som vises.
                    </div>
                    <div id="MutipleChoice1" class="multiplechoice">
                        <div>
                            <div class="form-group">
                                <label for="question1">Spørsmål:</label>
                                <input type="text" class="form-control" id="question1"
                                       placeholder="Skriv inn spørsmålet">
                            </div>
                            <div class="row">
                                <div id="choicesDiv1" class="col-md-10">
                                    <label class="checkbox-inline"><input type="checkbox" value="1"><input type="text"
                                                                                                           placeholder="Alternativ 1"></label>
                                    <label class="checkbox-inline"><input type="checkbox" value="1"><input type="text"
                                                                                                           placeholder="Alternativ 2"></label>
                                    <label class="checkbox-inline"><input type="checkbox" value="1"><input type="text"
                                                                                                           placeholder="Alternativ 3"></label>
                                </div>
                                <div class="col-md-2" id="choicesBtn1">
                                    <button class="btn btn-primary btn-sm border-radius" onclick="AddChoice(1)">
                                        Legg til alternativ
                                    </button>
                                    <button class="btn btn-danger btn-sm border-radius"
                                            onclick="RemoveChoice(1)">Fjern alternativ
                                    </button>
                                </div>
                            </div>
                            <div id="radioOrCheck1" style="margin-top: 10px;" class="hidden">
                                <label class="radio-inline">
                                    <input type="radio" name="radio1" value="radio" checked>Radio
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="radio1" value="check">Checkbox
                                </label>
                            </div>
                        </div>
                        <hr>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="AddQuestion()">Legg til flere spørsmål</button>
                    <button class="btn btn-danger" onclick="RemoveQuestion()" id="removeQuestionBtn"
                            disabled="disabled">Fjern spørsmål
                    </button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Lukk</button>
                </div>
            </div>
        </div>
    </div>
    <script>

        $(document).on('change', '.multiplechoice :checkbox', function () {
            var options = $("#MutipleChoice" + $(this).val() + " :checkbox:checked");
            if (options.length == 1) {
                $('#radioOrCheck' + $(this).val()).removeClass('hidden');
            } else {
                $('#radioOrCheck' + $(this).val()).addClass('hidden');
            }


        });
        /**
         * This function runs when the previewTaskModal is opened and shows the information about the task that
         * were selected.
         */
        $('#previewTaskModal').on('show.bs.modal', function () {
            $('#geogebradiv').hide();
            $('#textanswerdiv').hide();
            $('#reasoningdiv').hide();
            $('#multiplechoicediv').hide();
            var notGeo = $('#notGeogebraDiv');
            var answertype = $("input[type='radio'][name='answer_type']:checked").val();
            var previewtext = tinyMCE.get('tasktext').getContent();

            tinyMCE.get('previewtasktext').setContent(previewtext);

            if (document.getElementById('extra').checked) {
                $('#geogebradiv').show();
                var geogebrapreview = ggbApplet.getPNGBase64(1, false);
                $("#previewbilde").attr("src", 'data:image/png;base64,' + (geogebrapreview));
                if (!notGeo.hasClass('hidden')) {
                    notGeo.addClass('hidden');
                }
            } else {
                if (notGeo.hasClass('hidden')) {
                    notGeo.removeClass('hidden');
                }
            }

            if (answertype == 1) {
                $('#textanswerdiv').show();
            }
            else if (answertype == 2) {
                var div = $('#multiplechoicediv');
                div.empty();
                div.show();
                var questionDiv = $('#addMultipleChocice .modal-body .multiplechoice');
                var numQuestions = questionDiv.length;

                for (var i = 1; i <= numQuestions; i++) {
                    var fields = $("#MutipleChoice" + i + " :input[type=text]");
                    var question = fields.first().val();
                    div.append('<label for=multipleChoice' + i + '>' + question + '</label>');
                    var choices = fields.slice(1);
                    div.append('<br>');
                    var correct = 0;
                    $("#MutipleChoice" + i + " :input[type=checkbox]").each(function () {
                        if ($(this).is(':checked')) {
                            correct += 1;
                        }
                    });
                    choices.each(function () {
                        if (correct > 1) {
                            div.append('<label class="checkbox-inline"><input type="checkbox" value="">' + $(this).val() + '</label>');
                        } else if (correct == 1) {
                            var type = $('input[name=radio' + i + ']:checked', '#radioOrCheck' + i).val();
                            if (type == 'radio') {
                                div.append('<label class="radio-inline"><input type="radio" value="" name="choice' + i + '">' + $(this).val() + '</label>');
                            } else {
                                div.append('<label class="checkbox-inline"><input type="checkbox" value="">' + $(this).val() + '</label>');
                            }
                        } else {
                            div.append('<label class="radio-inline"><input type="radio" value="" name="choice' + i + '">' + $(this).val() + '</label>');
                        }
                    });
                    div.append('<br><hr>');
                }
            }
            if (document.getElementById('reasoning').checked) {
                $('#reasoningdiv').show();
                var reasoningText = $('#id_reasoningText').val();
                if (reasoningText) {
                    $('#reasoningText').text(reasoningText);
                } else {
                    $('#reasoningText').text("Begrunnelse");
                }

            }
        });

        $('.settings').change(function (e) {
            $('#id_' + e.target.id).click();
        })
    </script>
{% endblock %}