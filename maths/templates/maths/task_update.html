<!--Extends the base.html file that includes different imports and the navbar-->
{% extends 'matistikk/base.html' %}
<!--Loads the tag library-->
{% load bootstrap3 %}
<!-- loads the static files of the project-->
{% load staticfiles %}
{% load maths_extras %}
<!-- Loads CSS and javascript-->
{% bootstrap_css %}
{% bootstrap_javascript %}
<!--Display django.contrib.messages as Bootstrap alerts-->
{% bootstrap_messages %}
{% block head %}
    <!--Imports bootbox-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.min.js"></script>
    <!--Imports geogebra-->
    <script type="text/javascript" src="{% static 'administration/../../static/maths/js/deployggb.js' %}"></script>
    <!--Imports tinymce-->
    <script type="text/javascript" src="{% static 'tinymce/js/tinymce/tinymce.min.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static 'maths/css/sweetalert/sweetalert.css' %}">
    <script src="{% static 'maths/js/sweetalert/sweetalert.min.js' %}"></script>
    <!--Imports mathquill-->
    <script type="text/javascript"
            src="{% static 'tinymce/js/tinymce/plugins/equationeditor/mathquill.min.js' %}"></script>
    <script>
        configurl = '{% static 'tinymce/js/tinymce/plugins/equationeditor/config.json' %}';
        tinymce.PluginManager.load('equationeditor', "{% static 'tinymce/js/tinymce/plugins/equationeditor/plugin.min.js'%}");

        tinymce.init({
            selector: '#tasktext',
            plugins: 'equationeditor  textcolor lists fullscreen autolink link tabfocus table media image autoresize imagetools',
            content_css: '{% static 'tinymce/js/tinymce/plugins/equationeditor/mathquill.css'%}',
            toolbar: [
                'bold italic underline fontsizeselect | alignleft aligncenter alignright alignjustify | forecolor bullist numlist | subscript superscript equationeditor link | media image'
            ],
            autoresize_min_height: 100,
            statusbar: false,
            fontsize_formats: '8pt 10pt 12pt 14pt 18pt',
            menubar: false,
            autoresize_bottom_margin: 0
        });


    </script>
{% endblock %}

{% block body %}
    <form class="form-horizontal form-margin hidden" action="" method="POST"
          enctype="multipart/form-data">
        {% csrf_token %}
        {% bootstrap_form form %}
        <button type="submit" id="submitbutton" class="btn btn-success">
            {% bootstrap_icon "check" %} Lagre
        </button>
    </form>
    <div id="infoDiv" class="col-sm-6 col-md-6">
        <div class="panel panel-default">
            <div class="panel-heading" id="tasktextdiv">
                <h4 class="text-center geogebraHeader"><span
                        id="taskTitle">{{ task.title }}</span> <i
                        class="fa fa-pencil box updateTitle"
                        style="cursor:pointer;"
                        aria-hidden="true"></i>
                </h4>

            </div> <!-- #inner panel-heading -->
            <div class="panel-body taskBody" style="overflow: auto">
                <label for="tasktext">Oppgavetekst</label>
                <div id="tasktext">{{ task.text | safe }}</div>
                {% if task.category %}
                    <div style="margin-top: 15px;">
                    <span id="categorydiv">
                                {% for category in task.category.all %}
                                    <span class="label label-info" id="list{{ category }}">{{ category }}</span>
                                {% endfor %}
                            </span>
                        <a class="btn btn-default" data-toggle='modal' href='#changeCategoryModal'><i
                                class="fa fa-exchange" aria-hidden="true"
                                style="font-size: 1em; display: inline-block"></i> Endre kategorier</a>
                    </div>
                {% endif %}

                <label for="accordion" style="margin-top: 15px;">Velg svartype</label>
                <div id="accordion" class="panel-group" role="tablist">
                    <div class="panel panel-default answertype" id="textanswer" style="cursor: pointer">
                        <div class=" panel-heading" role="tab">
                            <h4 class="panel-title">
                                <label style="cursor: pointer"><input type="radio" name="answer_type" value="1"
                                                                      data-parent="#accordion" required
                                                                      id="textAnswerRadio">
                                    Tekstsvar</label>
                            </h4>
                        </div>
                        <div id="collapse5" class="panel-collapse collapse">
                            <div class="panel-body">
                                Hvis dette alternativet velges, vil eleven svare med tekst.
                                <button class="pull-right btn btn-primary addTaskTitle"><i class="fa fa-font"
                                                                                           aria-hidden="true"></i>
                                    Tittel
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default answertype" id="multiplechoiceanswer"
                         style="cursor: pointer">
                        <div class=" panel-heading" role="tab">
                            <h4 class="panel-title">
                                <label style="cursor: pointer"><input type="radio" name="answer_type" value="2"
                                                                      data-parent="#accordion" required
                                                                      id="textMutipleRadio">
                                    Flervalgstest</label>
                            </h4>
                        </div>
                        <div id="collapse8" class="panel-collapse collapse">
                            <div class="panel-body">
                                Legg til dine flervalgsspørsmål i modalen som åpner seg.
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default answertype" id="inputfieldanswer"
                         style="cursor: pointer">
                        <div class=" panel-heading" role="tab">
                            <h4 class="panel-title">
                                <label style="cursor: pointer"><input type="radio" name="answer_type" value="4"
                                                                      data-parent="#accordion" required
                                                                      id="textInputRadio">
                                    Inputfelt</label>
                            </h4>
                        </div>
                        <div id="collapse8" class="panel-collapse collapse">
                            <div class="panel-body">
                                Legg til dine inputfelt i modalen som åpner seg.
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default answertype" id="onlyExtraanswer" style="cursor: pointer">
                        <div class=" panel-heading" role="tab">
                            <p class="panel-title">
                                <label style="cursor: pointer"><input type="radio" name="answer_type" value="3"
                                                                      data-parent="#accordion"> Kun
                                    tillegg</label>
                            </p>
                        </div>
                        <div id="collapse7" class="panel-collapse collapse">
                            <div class="panel-body">
                                Hvis dette alternativet velges, vil eleven kunne svare kun med tillegg.
                            </div>
                        </div>
                    </div>
                </div>


                <ul class="list-group">
                    <li class="list-group-item">
                        Felt for begrunnelse
                        <div class="material-switch pull-right">
                            <input id="reason" name="reasoning1" type="checkbox"/>
                            <label for="reason" class="label-success"></label>
                        </div>
                    </li>
                    <li class="list-group-item">
                        Bruk tillegg (Geogebra, puslespill, rekkefølge etc..)
                        <div class="material-switch pull-right" id="extraField">
                            <input id="extra" name="extra1" type="checkbox"/>
                            <label for="extra" class="label-success"></label>
                        </div>
                    </li>
                </ul>
            </div> <!-- #inner panel-body -->
            <div class="panel-footer" id="taskFooter">
                <div class="btn-group" role="group" aria-label="...">
                    <button type="button" onclick="updateTask(true)" class="btn btn-success"
                            id="saveAsNewTaskBtn"><span
                            class="glyphicon glyphicon-check"
                            aria-hidden="true"></span> Lagre som ny oppgave
                    </button>
                    {% task_answered task as answered %}
                    {% if not answered %}
                        <button type="button" class="btn btn-warning" onclick="updateTask(false)"
                                id="updateTaskBtn"><span
                                class="glyphicon glyphicon-refresh"
                                aria-hidden="true"></span> Oppdater eksisterende
                        </button>
                    {% endif %}
                </div> <!-- #btn-group -->
                <button id="geogebraSettingsBtn"
                        class="btn btn-primary pull-right {% if not geogebra %}hidden{% endif %}"
                        data-toggle="modal" href="#geogebraSettings"><i
                        class="fa fa-sliders"
                        aria-hidden="true"></i>
                    </span> Innstillinger for GeoGebra
                </button>
            </div> <!-- #inner panel-footer -->
        </div> <!-- #inner panel -->
    </div>
    <div class="col-sm-6 col-md-6" id="extradiv">
        <input type="hidden" id="hiddenbase64" data-height="{{ geogebra.height }}"
               data-width="{{ geogebra.width }}" data-xmin="{{ geogebra.xmin }}" data-xmax="{{ geogebra.xmax }}"
               data-ymin="{{ geogebra.ymin }}" data-ymax="{{ geogebra.ymax }}"
               data-yratio="{{ geogebra.yratio }}" data-xstep="{{ geogebra.xstep }}" data-ystep="{{ geogebra.ystep }}"
               value="{{ geogebra.base64 }}">
        <div id="applet_container"></div>
    </div>

    <script>
        var viewPortWidth = 1200;
        var viewPortHeight = 750;
        var base64 = document.getElementById('hiddenbase64').value;
        if (!base64) {
            base64 = "UEsDBBQACAgIAOBc8UoAAAAAAAAAAAAAAAAXAAAAZ2VvZ2VicmFfZGVmYXVsdHMyZC54bWztWktv2zgQPm9/BaFT9xBbki3bCeIUaYHFBkjTYBMUvdLSWOaGIrUiFcv+9UuRsiTHjzpymrqpczA11PD1fcOZoZjzD1lE0SMkgnA2tJyWbSFgPg8IC4dWKscnA+vDxbvzEHgIowSjMU8iLIeWl2uW7ZTU6vT6eR3KBDlj/AZHIGLsw50/gQhfcx9LrTqRMj5rt6fTaWvRaYsnYTsMZSsTgYXUhJgYWsXDmepuqdG0o9Vd23ba3z5fm+5PCBMSMx8spCYbwBinVAr1CBQiYBLJWQxDK+aESQtRPAI6tG5zCb0fJwB/WqhopDCwrYt3f5yLCZ8iPvoXfFUnkxTKdlpo5zrq9SdOeYKSoaWWHurf0dByPc9CmMYTnNdoVYpnkKBHTMsanEru69a6doypgIWuGuczD8C86Rb6jEQaQyQkxGqeFhIxQKCfzPrUQ6wG0tzV+iPiboJjWBnH5zwJBMqG1g2+sdCsKOem1CoasTsyLxp79Vo5o1Bb0Xm7AHs32AOIgQVKaQl7pxH2vYEGPy9GpniL4HdeCvwvrA652whyx/U05ro8mvwOqF+xfyBUa6lj3zli/yrYL1t89+jgS8S1isFW5L9Dy+dRTCF7QUIoYRW411ooyXD3j7b2T6HCfnEqcpgMqHJC/AcGQuROvxovf/ibBCpo5vPQbeA/tkQeUdwRn8jthAgIc6nE+G4hV7Q0C8RHWgpMUknzOVwxqVJkhZ6as1gZ/AEgvleNv7D7BDORp9ZGZwHuZgYTPNvGnndk75DZG6dMd3rzFSclJ6nKhsdqtkGdyGYJwsZQ1XK9Q2Xz+2htR2r/oP5LmPzz7fkFzLDXzJ+4dnc9vK3+L2iGj2rZvMLpayGWIHWOmcw+TndNIooTCYJg9r10n87Cmne4XcglM33DTJNZPfto5nU0n56zYvOObf6c7qntOD117j5QirdDvZTM35YVFdjOq4F9oFtnM34+Z8QvF/XJSCVy3d/EgTQ655AQmPHAAqHM1qPPbK0+t4sP15mj5Zmj384dU63bqyUkJEOXpsWlUbx0TdExRdcUXglVs8OVJjlWvquWoD8JFd1mp6u34FzeCP2vcEhgaQRJzV3cLOTSjDzjMFR/KSyRvIN72GQxm+1DUBIoY4qIouVEnSkinOUfhBAeCU5TCXd+AsCqix5j0FMSyEmeCqqxxyTLDce8mPCEzDmTJRgo3w6XVN8I1XfAWntxt9vLU6tVy93beWMW0mqHXhqp4sJ8RtdKT7+MraOojqZdgNlruYOOM/A6dt/pn3qD3o7gOoPG4C65IAPCLtHGsXc2qP1d0LMcxsKME792cWJvsgp70Hd7vW7P9U5P+06v29/bSlYOq3+VFdVx6mcE+tqGWouytp+nqq9xCqXcT0X1edhIJVaD3yQpwmlGKMHJ7IdiLSGr0pJ7LdTuvQ8Q6s1LUQSE1dSujFS7SDaLGROFG8ORalDg" +
                "zz5i/yFMeMqC1RD3Ikt3DtXKNoM54pwCrpzWx4VcuyZeSTY2Abd7GPlh+9OfgP8w4tlSVNzuhYiodsa1FmrXtGt2xj7B8uRgTaRZer7bLeHJinNq1/5Tp734b6CL/wFQSwcI17MX3KcEAACUJAAAUEsDBBQACAgIAOBc8UoAAAAAAAAAAAAAAAAXAAAAZ2VvZ2VicmFfZGVmYXVsdHMzZC54bWztV91u2yAUvl6fAnHfGGI7aaq4VdRdbFJbrerNbgk+SdgccIH89dX2DnumYXBSp02mNUpVaWoucg5wfuD74ID7l8tpgeagjVAyw7RFMALJVS7kOMMzOzo9w5cXJ/0xqDEMNUMjpafMZjitLDd+rtWKO92qDy2NOJfqlk3BlIzDPZ/AlF0rzqw3nVhbnkfRYrForYO2lB5H47FtLU2OkZuQNBmulXMXbstpEXvzNiE0+n5zHcKfCmkskxwwcpPNYcRmhTVOhQKmIC2yqxIyzJUUPHY5CjaEIsNfpXUrAF7NDPGZnjv/2jnDMU0Jvjj51DcTtUBq+MPZZdjqGWz8fSOqbNzwlSqURjrD7TTFyKFH212Mhhl2oLCinDCntSgJP5r0CKUd2g7uBVuBRnNWVNa+h82s4j6i7x2xwsDa1uW+UTmEkaS2l2LqEUbGQumSY2RKgNxrYfVuHqVL5JltxBPmfsJKeJlHSLi3qwKQnQj+U4JxrMSNYJXyReQ5VBsn+IAYg5w7oJQ2bicQn31FvPkjqffXkvr2ivrRRxq6vb9bghZLNAgeg2A4aAcRB5EEkW6gggcZ5mmq/wyLaVkILmw12o/qHfBiL7ClMI2tMKian7foJ/FB9BNPPnlO/X9G9DPMS6bdgXfkcZc76OCw+P3r7yT4M8eZtmAEkw06rqqB53x0PvjYzcd+gF1eCQ1cv/n2Fq6ukh6Ea6/ngW3TnofWy02dS48F7z6QuFI6N2gZSkkoMP5/sUk1YtUtVmffW3l3gU0OBFsVqwnkWsknvBtdT5DHNeSHnLzX0kTT2POU0heXUVJDkvY6JOkkR+Ps2EdiP+IS7Gb5t5XexDj9wPgYGD/MWO7reg3B3brdxJoe9lIiye7i3Oq+eQF5i+fNzsdN1RleMKsgHtubgK9976BBJ4huEGdB9Gp09pNoZnrkHuO7rtp6aJvP5L34fAr8rtct/dcbIGp8bETrD5qLP1BLBwgbBrQ/3gIAAFcNAABQSwMEFAAICAgA4FzxSgAAAAAAAAAAAAAAABYAAABnZW9nZWJyYV9qYXZhc2NyaXB0LmpzSyvNSy7JzM9TSE9P8s/zzMss0dBUqK4FAFBLBwjWN725GQAAABcAAABQSwMEFAAICAgA4FzxSgAAAAAAAAAAAAAAAAwAAABnZW9nZWJyYS54bWytV21v2zYQ/tz+ioM+JzZJkXop7BZO2wADuqJYtmHYN1libCKyZIh0nAz98bsjJdlO2qJpkoQgeXp4d88dyWNm7+42Ndzqzpq2mUd8wiLQTdlWplnNo527Ps+id29fz1a6XellV8B1220KN48UIcd1OJvESUoyU82j93KRs" +
                "MXF5Xn88fLyXH7gH88vLi4X5zxP5WLxIc6EvIwA7qx507Sfi42226LUV+Vab4pPbVk4r3Tt3PbNdLrf7yeD+Unbraar1XJyZ6sI0PXGzqN+8AbVnSzaxx4uGOPTf37/FNSfm8a6oil1BERrZ96+fjXbm6Zq97A3lVvPo1zyCNbarNbIM0llBFMCbZHsVpfO3GqLS4+mnrPbbCMPKxr6/iqMoB7pRFCZW1Ppbh6xCc+zVMg0YVkukiSNswjazujG9WDeG50O6ma3Ru+DXhp5k5LlKSbBWLOs9Ty6LmqLtExz3WFI0aNuh1Pr7mu9LLphfnCIn/lfhJj/NGnD7IVI4DfGzqil2JRiwZsj04qLCFzb1l4zg6/AQTFswHM4gyRFiQCuQKIkQ0kKMckUlxADQXgMUmIvScwT+qZwvWLAOYpBMBACBAcR41QpUAmolBYKxCa5V8awERrdwRaTLI6xeVkssQkaoSIV1KATKk78SBEa9StB7nthnIHM0RAJVMohRh9wnjJAjTGp556EZEB/HCSpFymIDFAf8ibNTPwgKf38kJVe8CAtQ1LUt5KSYPPZepAUeZoSzABDbmfU8dCJIGVhyuLQidDJ0KmAkWGlDNBAlMmAkfFzGQ784qfwy474cSKB+SDvfRcD+c29/9TJfpqEqd9ljLNemgVpTtPkmWTiXyLDj6yGk/kUo4PJVMqfNymeY3JkybP0sUmhvsPymcH9ZmjRlv/z7ZHJ+EnH79Gl+AsWk5OD9zKEZfbT5rnInlAFXsRkyr551YSe9/3L5CH/+Tw891oaA6F+bHI2HYrxrA8C2DVh+0Pl9MZSWNIYEjGWxoSKV18fUwGpgjQ5qpJnVCcTdSiVVCizk1KpsqN6icUyIWHqiy9WKKp2oXYKOZTPs76Afn1UQLHeyUPJQwdJFQfA+gwJ3Y597UMvxFj9hKICKBLACqkEJHQDf6cQRrBtrRkDu9b1dgy5j6Fptjt3ErdyUw1D1yK6qP2br8dXbXlzMU" +
                "a616QL647V4nvp8CwL76eTV9urWV0sdY2P2yvaBwC3RU1H1lu4bhsHwyWXRF6dfyDO9K6sTWWK5m/M+/AY+7zbLHUHftgSSa+ElsPwkvS38/iS5HmAlG3bVVf3FrcJ3P2rO1wsuIrgPoxjLif58Q/qsGVR+9cAovqxzE9RvXJ9e6WdQ4IWijtth4CuOlMdj3+zF21djaHbtqZx74ut23X+4Y8HqSOvF82q1j5UPov4gi5vlu3dlY+RSIKuP++3egzicvW+rdsO8IAJhaRWfb8MvceQYyOKeQzziF4HKR2/81x4hO+XofcozGJwrSfKB5ZssGIshPnJNvM7gJ7ju8a4T8PEmfLmQJTwIb9DBE9V8hdSOZs+2FqzftMPG23TVjps0jjgT77PbnTX6Dpsqgazvmt3NsBDYr3XO6u/FG69aKo/9AoP5JeCbkSHjgTogV+lS7PBhUHex7mgPfAXEgvSSq86PcQjOBOy0HsJdtvporJrrd2Yi7DlDzAWyAzuz2zZmS3tWljifXyjDzuzMrbA+7w6YkRcLTpd0u2CUXYU4QiKnVu3nf8/q3AkIQvHUH+e+38k3/4PUEsHCEmD3IIpBQAA+Q4AAFBLAQIUABQACAgIAOBc8UrXsxfcpwQAAJQkAAAXAAAAAAAAAAAAAAAAAAAAAABnZW9nZWJyYV9kZWZhdWx0czJkLnhtbFBLAQIUABQACAgIAOBc8UobBrQ/3gIAAFcNAAAXAAAAAAAAAAAAAAAAAOwEAABnZW9nZWJyYV9kZWZhdWx0czNkLnhtbFBLAQIUABQACAgIAOBc8UrWN725GQAAABcAAAAWAAAAAAAAAAAAAAAAAA8IAABnZW9nZWJyYV9qYXZhc2NyaXB0LmpzUEsBAhQAFAAICAgA4FzxSkmD3IIpBQAA+Q4AAAwAAAAAAAAAAAAAAAAAbAgAAGdlb2dlYnJhLnhtbFBLBQYAAAAABAAEAAgBAADPDQAAAAA=";
        }
        var geo = $('#hiddenbase64');
        var width = geo.data('width');
        var height = geo.data('height');
        var xmin = parseFloat(geo.data('xmin').replace(",", "."));
        var xmax = parseFloat(geo.data('xmax').replace(",", "."));
        var ymin = parseFloat(geo.data('ymin').replace(",", "."));
        var ymax = parseFloat(geo.data('ymax').replace(",", "."));
        if (typeof window.innerWidth != 'undefined') {
            viewPortWidth = (window.innerWidth * 0.5) - 30;
            viewPortHeight = window.innerHeight - 55;
        }
        /*if (height && width) {
         viewPortHeight = height;
         viewPortWidth = width;
         }*/
        var parameters = {
            "id": "ggbApplet",
            "width": viewPortWidth,
            "height": viewPortHeight,
            "showToolBar": true,
            "borderColor": null,
            "showMenuBar": true,
            "allowStyleBar": true,
            "showAlgebraInput": true,
            "enableLabelDrags": false,
            "enableShiftDragZoom": true,
            "capturingThreshold": null,
            "showToolBarHelp": false,
            "errorDialogsActive": true,
            "showTutorialLink": false,
            "showLogging": false,
            "language": "nb",
            "preventFocus": true,
            "useBrowserForJS": false,
            "ggbBase64": base64
        };
        /**
         * This function is called from every GeoGebra-applet when the applet is finished loading.
         * @param param - The id of the applet that called the function
         */
        parameters.appletOnLoad = function () {
            if (geobase64 == null || geobase64 == "") {
                $('#extradiv').hide();
                $('#infoDiv').addClass('col-centered');
                $('#infoDiv').removeClass('col-sm-6 col-md-6');
                $('#infoDiv').addClass('col-sm-8 col-md-8');
            }
            else {
                if (xmin) {
                    var geo = $('#hiddenbase64');
                    var yratio = parseFloat(geo.data('yratio').replace(",", "."));
                    var xstep = parseFloat(geo.data('xstep').replace(",", "."));
                    var ystep = parseFloat(geo.data('ystep').replace(",", "."));
                    ggbApplet.evalCommand("matistikk_c1 = Corner(1)");
                    ggbApplet.evalCommand("matistikk_c2 = Corner(2)");
                    ggbApplet.evalCommand("matistikk_c3 = Corner(3)");
                    ggbApplet.evalCommand("matistikk_c5 = Corner(5)");
                    ggbApplet.setCoordSystem(xmin, xmax, ymin, ymax);
                    ggbApplet.evalCommand("matistikk_ratio =  (x(matistikk_c5)/(Distance[matistikk_c1,matistikk_c2])) / (y(matistikk_c5)/(Distance[matistikk_c2,matistikk_c3]))");
                    if (yratio < 1) {
                        var ratio = 1 / yratio;
                        var geoRatio = ggbApplet.getValue("matistikk_ratio") * ratio;
                        ggbApplet.setCoordSystem(xmin * geoRatio, xmax * geoRatio, ymin, ymax);
                    } else {
                        var ratio = yratio;
                        var geoRatio = ratio / ggbApplet.getValue("matistikk_ratio");
                        ggbApplet.setCoordSystem(xmin, xmax, ymin * geoRatio, ymax * geoRatio);
                    }
                    ggbApplet.deleteObject("matistikk_c2");
                    ggbApplet.deleteObject("matistikk_c5");
                    ggbApplet.deleteObject("matistikk_ratio");
                    //ggbApplet.evalCommand("SetAxesRatio(1," + yratio + ")");
                    ggbApplet.setAxisSteps(1, xstep, ystep, 1);
                } else {
                    alert('old');
                    if (window.innerWidth > window.innerHeight) {
                        var scaledWidth = (window.innerWidth * 0.50) / width;
                        var scaledHeight = (window.innerHeight * 0.93) / height;
                    } else {
                        var scaledWidth = (window.innerWidth * 0.49) / width;
                        var scaledHeight = (window.innerHeight * 0.50) / height;
                    }
                    $('.applet_scaler').css('transform-origin', '0% 0% 0px');
                    if (scaledWidth < scaledHeight) {
                        scaledHeight = scaledWidth;
                    } else {
                        scaledWidth = scaledHeight;
                    }
                    var appletContainerScaler = $('#applet_container .applet_scaler');
                    appletContainerScaler.css('transform', 'scale(' + scaledWidth + ',' + scaledHeight + ')');
                    appletContainerScaler.css('-webkit-transform', 'scale(' + scaledWidth + ',' + scaledHeight + ')');
                    appletContainerScaler.css('-ms-transform', 'scale(' + scaledWidth + ',' + scaledHeight + ')');
                    document.getElementById('ggbApplet').setAttribute('data-scalex', scaledWidth);
                    document.getElementById('ggbApplet').setAttribute('data-scaley', scaledHeight);
                }
            }

        };

        // Applet som inneholder GeoGebra-vinduet som lastes inn i createfunctiontask.jsp
        var applet = new GGBApplet(parameters, '5.0', 'applet_container');
        //  when used with Math Apps Bundle, uncomment this:
        // applet.setHTML5Codebase('GeoGebra/HTML5/5.0/web3d/');
        applet.setPreviewImage('http://bildr.no/image/cEtUd3R6.jpeg', 'https://www.geogebra.org/images/GeoGebra_loading.png?v=1490705653', 'https://www.geogebra.org/images/applet_play.png?v=1490705653');

        // Metoden benyttes til å legge GeoGebra med forhåndsvalgt konfigurasjon inn i en applet
        window.onload = function () {
            applet.inject('applet_container', 'preferhtml5');
            tinyMCE.get('tasktext').getBody().style.backgroundColor = "#f5f5f5";
        };

        window.onresize = function (event) {
            /*$('.applet_scaler').css('transform-origin', '0% 0% 0px');
             var appletContainerScaler = $('#applet_container .applet_scaler');
             var scaledWidth = (window.innerWidth * 0.5) / width;
             var scaledHeight = (window.innerHeight * 0.93) / height;
             appletContainerScaler.css('transform', 'scale(' + scaledWidth + ',' + scaledHeight + ')');
             appletContainerScaler.css('-webkit-transform', 'scale(' + scaledWidth + ',' + scaledHeight + ')');
             appletContainerScaler.css('-ms-transform', 'scale(' + scaledWidth + ',' + scaledHeight + ')');
             document.getElementById('ggbApplet').setAttribute('data-scalex', scaledWidth);
             document.getElementById('ggbApplet').setAttribute('data-scaley', scaledHeight);*/
        };

    </script>
    <script>
        if (document.getElementById('hiddenbase64')) {
            var geobase64 = document.getElementById('hiddenbase64').value;
        }
        /**
         * This function opens a modal that lets the user change the title of the task.
         */
        $('.updateTitle').click(function () {
            bootbox.prompt({
                title: "Skriv inn ny oppgavetittel!",
                placeholder: 'Skriv inn en ny oppgavetittel!',
                value: $('#taskTitle').text(),
                buttons: {
                    cancel: {
                        label: '<i class="fa fa-times"></i> Avbryt'
                    },
                    confirm: {
                        label: '<i class="fa fa-check"></i> Endre'
                    }
                },
                callback: function (result) {
                    if (result) {
                        $('#taskTitle').text(result);
                        $('#id_title').val(result);
                    }
                }
            });
        });
        $('#reason').change(function () {
            if (document.getElementById('reason').checked) {
                var reasoningTextField = $('#id_reasoningText');
                bootbox.prompt({
                    title: "Skriv inn tittel for begrunnelsesfeltet.",
                    placeholder: 'Begrunnelse!',
                    value: reasoningTextField.val(),
                    buttons: {
                        cancel: {
                            label: '<i class="fa fa-times"></i> Avbryt'
                        },
                        confirm: {
                            label: '<i class="fa fa-check"></i> Lagre'
                        }
                    },
                    callback: function (result) {
                        if (result) {
                            reasoningTextField.val(result);
                        }
                    }
                });
            }
        });


        $('.answertype').click(function (e) {
            if ($(e.target).is(":radio")) {
                e.preventDefault();
            } else {
                if ($(this).hasClass('panel-success')) {
                    if ($(this).find(':radio').val() == 2) {
                        $('#addMultipleChocice').modal('show');
                    } else if ($(this).find(':radio').val() == 4) {
                        $('#addInputModal').modal('show');
                    }
                } else {
                    $('.collapse.in').collapse('toggle');
                    $('.panel-success').removeClass('panel-success');
                    $(this).find('.collapse').collapse('toggle');
                    $(this).addClass('panel-success');
                    $(this).find(':radio').prop('checked', true);
                    if ($(this).find(':radio').val() == 2) {
                        $('#addMultipleChocice').modal('show');
                    } else if ($(this).find(':radio').val() == 4) {
                        $('#addInputModal').modal('show');
                    }
                }
            }

        });

        $('.addTaskTitle').click(function () {
            var taskTextField = $('#id_answerText');
            bootbox.prompt({
                title: "Skriv inn tittel for tekstfeltet.",
                placeholder: 'Tittel for tekstfeltet',
                value: taskTextField.val(),
                buttons: {
                    cancel: {
                        label: '<i class="fa fa-times"></i> Avbryt'
                    },
                    confirm: {
                        label: '<i class="fa fa-check"></i> Lagre'
                    }
                },
                callback: function (result) {
                    taskTextField.val(result);
                }
            });
        });

        /**
         * This function parse data from custom input fields into the hidden django-form
         * and clicks the submit-button in the django-form when its done.
         */
        var submit = false;
        function updateTask(createNew) {
            if (submit) {
                return 0;
            }
            var tasktext = tinyMCE.activeEditor.getContent();
            var tasktext2 = document.getElementById('id_text');
            var answertype = $('input[name=answer_type]:checked').val();
            var answertype2 = document.getElementById('id_answertype');
            var reasoning = document.getElementById('reason');
            var reasoning2 = document.getElementById('id_reasoning');
            var extra = document.getElementById('extra');
            var extra2 = document.getElementById('id_extra');
            var base64 = document.getElementById('id_base64');
            var preview = document.getElementById('id_preview');
            var categories = document.getElementById('id_category');
            var spans = document.getElementById('categorydiv').getElementsByTagName('span');
            var categoryoptions = categories.getElementsByTagName('option');
            var options = document.getElementById('id_options');
            if (createNew) {
                $('#id_create_new').attr('checked', true);
            }
            document.getElementById('tasktext').innerHTML = tasktext;
            options.value = "";

            if (reasoning.checked) {
                reasoning2.checked = true;
            }
            else {
                reasoning2.checked = false;
            }

            if (extra.checked) {
                extra2.checked = true;
                base64.value = ggbApplet.getBase64();
                preview.value = ggbApplet.getPNGBase64(1, false);
                var width = document.getElementById('id_width');
                var height = document.getElementById('id_height');
                if (!width.value && !height.value) {
                    var viewPortWidth = window.innerWidth * 0.49;
                    var viewPortHeight = window.innerHeight * 0.7;
                    width.value = (viewPortWidth);
                    height.value = (viewPortHeight);
                }
                ggbApplet.evalCommand("matistikk_c1 = Corner(1)");
                ggbApplet.evalCommand("matistikk_c2 = Corner(2)");
                ggbApplet.evalCommand("matistikk_c3 = Corner(3)");
                ggbApplet.evalCommand("matistikk_c5 = Corner(5)");
                ggbApplet.evalCommand("matistikk_ratio =  (x(matistikk_c5)/(Distance[matistikk_c1,matistikk_c2])) / (y(matistikk_c5)/(Distance[matistikk_c2,matistikk_c3]))");
                ggbApplet.evalCommand("matistikk_xstep = AxisStepX[]");
                ggbApplet.evalCommand("matistikk_ystep = AxisStepY[]");
                var ratio = ggbApplet.getValue("matistikk_ratio");
                $('#id_yratio').val(ratio);
                $('#id_xmin').val(ggbApplet.getXcoord("matistikk_c1"));
                $('#id_xmax').val(ggbApplet.getXcoord("matistikk_c3"));
                $('#id_ymin').val(ggbApplet.getYcoord("matistikk_c1"));
                $('#id_ymax').val(ggbApplet.getYcoord("matistikk_c3"));
                $('#id_xstep').val(ggbApplet.getValue("matistikk_xstep"));
                $('#id_ystep').val(ggbApplet.getValue("matistikk_ystep"));
                ggbApplet.deleteObject("matistikk_c1");
                ggbApplet.deleteObject("matistikk_c2");
                ggbApplet.deleteObject("matistikk_c3");
                ggbApplet.deleteObject("matistikk_c5");
                ggbApplet.deleteObject("matistikk_ratio");
                ggbApplet.deleteObject("matistikk_xstep");
                ggbApplet.deleteObject("matistikk_ystep");
            }
            else {
                extra2.checked = false;
                base64.value = null;
            }

            if (tasktext == "") {
                swal("Oops", "Du må legge til en oppgavetekst før du kan oppdatere oppgaven!", "error");
                document.getElementById('tasktextdiv').innerHTML += '<div class="alert alert-danger alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Oops!</strong>  </div>';
                return 0;
            }
            tasktext2.value = tasktext;

            if (answertype) {
                answertype2.value = answertype;
            }

            for (var s = 0; s < categoryoptions.length; s++) {
                categoryoptions[s].selected = false;
            }

            if (spans.length < 1) {
                swal("Oops", "Du må velge minst en kategori før du kan oppdatere oppgaven!", "error");
                return 0;
            }

            for (var i = 0; i < spans.length; i++) {
                for (var k = 0; k < categoryoptions.length; k++) {
                    if (spans[i].innerHTML == categoryoptions[k].innerHTML) {
                        categoryoptions[k].selected = true;
                    }
                }
            }
            if (answertype == 2) {
                var correct = document.getElementById('id_correct');
                var questionsField = document.getElementById('id_questions');
                var radioOrCheck = document.getElementById('id_radioOrCheck');
                var questionDiv = $('#addMultipleChocice .modal-body .multiplechoice');
                var numQuestions = questionDiv.length;

                for (var i = 1; i <= numQuestions; i++) {
                    var fields = $("#MutipleChoice" + i + " :input[type=text]");
                    var question = fields.first().val();
                    questionsField.value += question + '|||||';
                    var choices = fields.slice(1);
                    var breakFunction = false;
                    choices.each(function () {
                        if ($(this).val()) {
                            options.value += $(this).val() + '|||||';
                        } else {
                            breakFunction = true;
                        }
                    });
                    var checked = $("#MutipleChoice" + i + " :checkbox:checked");
                    if (checked.length == 1) {
                        var type = $('input[name=radio' + i + ']:checked', '#radioOrCheck' + i).val();
                        if (type == 'radio') {
                            radioOrCheck.value += false + '|||||';
                        } else {
                            radioOrCheck.value += true + '|||||';
                        }
                    } else {
                        radioOrCheck.value += true + '|||||';
                    }
                    if (breakFunction) {
                        $('#multipleChoiceWarning').removeClass('hidden');
                        $("#multipleChoiceWarning").fadeTo(5000, 500).slideUp(500, function () {
                            $('#multipleChoiceWarning').slideUp(500);
                        });
                        $('#addMultipleChocice').modal('show');
                        return 0;
                    }
                    $("#MutipleChoice" + i + " :input[type=checkbox]").each(function () {
                        correct.value += $(this).is(':checked') + '|||||'
                    });
                    options.value = options.value.slice(0, -5);
                    correct.value = correct.value.slice(0, -5);
                    options.value += '<--->';
                    correct.value += '<--->';
                }
                options.value = options.value.slice(0, -5);
                correct.value = correct.value.slice(0, -5);
                questionsField.value = questionsField.value.slice(0, -5);
            }
            if (answertype == 4) {
                var numInputs = $('.inputs').length;
                var inputfield = document.getElementById('id_inputField');
                var inputQuestion = document.getElementById('id_inputQuestion');
                var inputLength = document.getElementById('id_inputLength');
                var inputCorrect = document.getElementById('id_inputCorrect');
                var inputFraction = document.getElementById('id_inputFraction');
                inputQuestion.value = "";
                inputfield.value = "";
                for (var i = 1; i <= numInputs; i++) {
                    var question = $('#inputText' + i).val();
                    inputQuestion.value += question + "|||||";
                    $('.inputform' + i + ' input[type=text]').each(function () {
                        inputfield.value += $(this).val() + "|||||";
                    });
                    $('.selectform' + i + ' .form-control').each(function () {
                        inputLength.value += $(this).find(":selected").val() + "|||||";
                    });
                    $('.answerform' + i + ' input[type=number').each(function () {
                        inputCorrect.value += $(this).val() + "|||||";
                    });
                    $('.fractionform' + i + ' :button').each(function () {
                        inputFraction.value += $(this).val() + "|||||";
                    });
                    inputfield.value = inputfield.value.slice(0, -5);
                    inputfield.value += "<--->";
                    inputLength.value = inputLength.value.slice(0, -5);
                    inputLength.value += "<--->";
                    inputCorrect.value = inputCorrect.value.slice(0, -5);
                    inputCorrect.value += "<--->";
                    inputFraction.value = inputFraction.value.slice(0, -5);
                    inputFraction.value += "<--->";
                }
                inputfield.value = inputfield.value.slice(0, -5);
                inputQuestion.value = inputQuestion.value.slice(0, -5);
                inputLength.value = inputLength.value.slice(0, -5);
                inputCorrect.value = inputCorrect.value.slice(0, -5);
                inputFraction.value = inputFraction.value.slice(0, -5);
            }

            document.getElementById('submitbutton').click();
            submit = true;
        }


        /**
         * This function hides all the parts of the task when the document get loaded,
         * then it shows the parts of the task that is chosen to be seen.
         */
        jQuery(document).ready(function ($) {
            $('#reasoning').hide();
            $('label[for=reasoning]').hide();
            $('#textanswerdiv').hide();
            $('#multiplechoicediv').hide();
            $('#extraanswerdiv').hide();
            var questionDiv = $('#addMultipleChocice .modal-body .multiplechoice');
            var numQuestions = questionDiv.length;
            if (numQuestions >= 2) {
                $('#removeQuestionBtn').prop('disabled', false);
            }

            if (document.getElementById('id_reasoning').checked) {
                $('#reason').prop('checked', true);
            }

            if (document.getElementById('id_extra').checked) {
                $('#extra').prop('checked', true);
            }

            if (document.getElementById('id_answertype').value == 1) {
                var textanswer = $('#textanswer');
                textanswer.addClass('panel-success');
                textanswer.find(':radio').prop('checked', true);
                textanswer.find('.collapse').collapse('toggle');
            } else if (document.getElementById('id_answertype').value == 2) {
                var multiplechoice = $('#multiplechoiceanswer');
                multiplechoice.addClass('panel-success');
                multiplechoice.find(':radio').prop('checked', true);
                multiplechoice.find('.collapse').collapse('toggle');
            } else if (document.getElementById('id_answertype').value == 3) {
                var onlyExtra = $('#onlyExtraanswer');
                onlyExtra.addClass('panel-success');
                onlyExtra.find(':radio').prop('checked', true);
                onlyExtra.find('.collapse').collapse('toggle');
            } else if (document.getElementById('id_answertype').value == 4) {
                var inputfieldanswer = $('#inputfieldanswer');
                inputfieldanswer.addClass('panel-success');
                inputfieldanswer.find(':radio').prop('checked', true);
                inputfieldanswer.find('.collapse').collapse('toggle');
                $('.fraction').click();
            }
            var windowHeight = window.innerHeight;
            var navbar = 50;
            var header = $('#tasktextdiv').outerHeight();
            var footer = $('#taskFooter').outerHeight();
            var height = windowHeight - navbar - header - footer - 5;
            $('.taskBody').css('height', height + 'px');
            //$('.col-md-6').css('height', (windowHeight - 50) + 'px');
            $('body').css('overflow', 'hidden');

        });

        /**
         * This function changes the visibility of the reasoning-div when the user
         * changes the boolean value of the "Field for reasoning"-switch.
         */
        $('#reason').change(function () {
            if (document.getElementById('reason').checked) {
                $('#reasoning').show();
                $('label[for=reasoning]').show();
            }
            else {
                $('#reasoning').hide();
                $('label[for=reasoning]').hide();
            }
        });

        /**
         * This function changes the visibility of the extra-div when the user
         * changes the boolean value of the "Use extra"-switch.
         */
        $('#extra').change(function () {
            var infoDiv = $('#infoDiv');
            if (document.getElementById('extra').checked) {
                $('#extradiv').show();
                infoDiv.removeClass('col-centered');
                infoDiv.removeClass('col-sm-8 col-md-8');
                infoDiv.addClass('col-sm-6 col-md-6');
                $('#geogebraSettingsBtn').removeClass('hidden')
            }
            else {
                $('#extradiv').hide();
                infoDiv.addClass('col-centered');
                infoDiv.removeClass('col-sm-6 col-md-6');
                infoDiv.addClass('col-sm-8 col-md-8');
                $('#geogebraSettingsBtn').addClass('hidden')

            }
        });
        function AddQuestion() {
            $('#removeQuestionBtn').prop('disabled', false);
            var questionDiv = $('#addMultipleChocice .modal-body .multiplechoice');
            var numQuestions = questionDiv.length;
            var ModalBody = $('#addMultipleChocice .modal-body');
            var nextQuestion = parseInt(numQuestions + 1);
            ModalBody.append('<div id="MutipleChoice' + nextQuestion + '" class="multiplechoice"><div><div class="form-group">' +
                '<label for="question' + nextQuestion + '">Spørsmål:</label> <input type="text" class="form-control" id="question' + nextQuestion + '"' +
                'placeholder="Skriv inn spørsmålet"></div><div class="row"><div id="choicesDiv' + nextQuestion + '" class="col-md-10">' +
                '<label class="checkbox-inline"><input type="checkbox" value="' + nextQuestion + '"><input type="text" placeholder="Alternativ 1"></label> ' +
                '<label class="checkbox-inline"><input type="checkbox" value="' + nextQuestion + '"><input type="text" placeholder="Alternativ 2"></label>' +
                '<label class="checkbox-inline"><input type="checkbox" value="' + nextQuestion + '"><input type="text" placeholder="Alternativ 3"></label> ' +
                '</div><div class="col-md-2" id="choicesBtn' + nextQuestion + '"> <button style = "margin-right:4px;" class="btn btn-primary btn-sm border-radius" onclick="AddChoice(' + nextQuestion + ')">Legg til alternativ</button>' +
                '<button class="btn btn-danger btn-sm border-radius" onclick="RemoveChoice(' + nextQuestion + ')">Fjern alternativ</button></div></div>' +
                '<div id="radioOrCheck' + nextQuestion + '" style="margin-top: 10px;" class="hidden"> <label class="radio-inline"><input type="radio" value="radio" name="radio' + nextQuestion + '" checked>Radio</label>' +
                '<label class="radio-inline"><input type="radio" value="check" name="radio' + nextQuestion + '">Checkbox</label></div></div><hr></div>');
        }

        function RemoveQuestion() {
            var questionDiv = $('#addMultipleChocice .modal-body .multiplechoice');
            var numQuestions = questionDiv.length;
            var lastQuestion = parseInt(numQuestions);
            $('#MutipleChoice' + lastQuestion).remove();
            if (numQuestions <= 2) {
                $('#removeQuestionBtn').prop('disabled', true);
            }
        }

        function AddChoice(num, btn) {
            var numChoices = $('#choicesDiv' + num + ' :input[type=checkbox]').length + 1;
            $('#choicesDiv' + num).append('<label class="checkbox-inline"><input type="checkbox"><input type="text" placeholder="Alternativ ' + numChoices + '"></label>');
            if (numChoices >= 6) {
                $('#choicesBtn' + num + ' .btn').first().prop('disabled', true);
            } else if (numChoices > 2) {
                $('#choicesBtn' + num + ' .btn').last().prop('disabled', false);
            }
        }

        function RemoveChoice(num, btn) {
            $('#choicesDiv' + num + ' .checkbox-inline').last().remove();
            var numChoices = $('#choicesDiv' + num + ' :input[type=checkbox]').length - 1;
            if (numChoices < 2) {
                $('#choicesBtn' + num + ' .btn').last().prop('disabled', true);
            } else if (numChoices < 6) {
                $('#choicesBtn' + num + ' .btn').first().prop('disabled', false);

            }
        }

        function addInput() {
            $('#removeInputBtn').prop('disabled', false);
            var numInputs = $('.inputs').length;
            var next = numInputs + 1;
            var modalBody = $('#addInputModal .modal-body');
            modalBody.append('<div id="input' + next + '" class="inputs"></div>');
            var input = $('#input' + next);
            input.append('<div id="inputFields' + next + '"></div>');
            input.append('<div style="padding-top: 10px"><button class="btn btn-primary btn-sm" style="margin-right: 5px" onclick="addInputField(' + next + ')">' +
                'Legg til flere inputfelt</button><button class="btn btn-danger btn-sm" onclick="removeInputField(' + next + ')" ' +
                'id="removeInputBtn' + next + '"disabled="disabled">Fjern inputfelt</button></div>');
            var inputFields = $('#inputFields' + next);
            inputFields.append('<form><div class="form-group"><label for="inputText' + next + '">Deloppgave:</label>' +
                '<input type="text" class="form-control" id="inputText' + next + '" placeholder="Oppgave"></div></form>');
            addInputField(next);
            input.append('<hr>');

        }

        function removeInput() {
            var inputs = $('.inputs');
            inputs.last().remove();
            var numInputs = inputs.length;
            if (numInputs <= 2) {
                $('#removeInputBtn').prop('disabled', true);
            }
        }

        function addInputField(num) {
            $('#removeInputBtn' + num).prop('disabled', false);
            var inputform = $('#inputFields' + num);
            inputform.append('<div class="col-md-12 inputrow' + num + '"><div class="col-md-4"><form class="form-inline inputform' + num + '"> <div class="form-group">' +
                '<input type="text" placeholder="Titel for inputfelt" class="form-control">' +
                '<strong> : </strong><input type="number" class="form-control"></div></form></div><div class="col-md-2 pull-right answerform' + num + '">' +
                '<input type="number" class="form-control" placeholder="Skriv inn rett svar"></div>' +
                '<div class="col-md-2 pull-right selectform' + num + '"><div class="form-group"><select class="form-control"><option value="10" disabled selected>Lengden av inputfeltet</option>' +
                '<option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option>' +
                '<option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option></select></div></div>' +
                '<div class="col-md-2 pull-right fractionform' + num + '"><button class="btn btn-primary pull-right" style="margin-right: 5px" ' +
                'value="0" onclick="addFractionLine(this)">Legg til brøkstrek</button></div></div>');
        }
        function removeInputField(num) {
            var inputFields = $('.inputrow' + num);
            inputFields.last().remove();
            var numFields = inputFields.length;
            if (numFields <= 2) {
                $('#removeInputBtn' + num).prop('disabled', true);
            }
        }

        function addFractionLine(elem) {
            var input = $(elem).parent('.col-md-2').parent('.col-md-12').find('.form-inline .form-group');
            if (elem.value === "0") {
                input.append('<div class="col-md-6"></div><div class="col-md-6">' +
                    '<hr style="margin-top: 5px; margin-bottom: 5px; border-top: 2px solid black; padding-left: 5px;">' +
                    '</div>');
                elem.value = "1";
                $(elem).text('Fjern brøkstrek');
            } else {
                input.find('.col-md-6').remove();
                elem.value = "0";
                $(elem).text('Legg til brøkstrek');
            }
        }
    </script>

{% endblock %}

{% block modal %}
    <div class="modal fade" id="geogebraSettings" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header" style="background-color: whitesmoke">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title text-center" id="myModalLabel">Innstillinger for GeoGebra</h4>
                </div>
                <div class="modal-body">
                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th>Valgt</th>
                            <th>Navn</th>
                            <th>Beskrivelse</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>
                                <div class="material-switch">
                                    <input id="showMenuBar" class="settings" name="showMenuBar" type="checkbox"
                                           {% if geogebra.showMenuBar %}checked{% endif %}/>
                                    <label for="showMenuBar" class="label-success"></label>
                                </div>
                            </td>
                            <td>showMenuBar</td>
                            <td>States whether the menubar of GeoGebra should be shown in the applet.</td>
                        </tr>
                        <tr>
                            <td>
                                <div class="material-switch">
                                    <input id="enableLabelDrags" class="settings" name="enableLabelDrags"
                                           type="checkbox"
                                           {% if geogebra.enableLabelDrags or not geogebra %}checked{% endif %}/>
                                    <label for="enableLabelDrags" class="label-success"></label>
                                </div>
                            </td>
                            <td>enableLabelDrags</td>
                            <td>States whether labels can be dragged.</td>
                        </tr>
                        <tr>
                            <td>
                                <div class="material-switch">
                                    <input id="enableShiftDragZoom" class="settings" name="enableShiftDragZoom"
                                           type="checkbox"
                                           {% if geogebra.enableShiftDragZoom or not geogebra %}checked{% endif %}/>
                                    <label for="enableShiftDragZoom" class="label-success"></label>
                                </div>
                            </td>
                            <td>enableShiftDragZoom</td>
                            <td>States whether the drawing pad should be moveable.</td>
                        </tr>
                        <tr>
                            <td>
                                <div class="material-switch">
                                    <input id="enableRightClick" class="settings" name="enableRightClick"
                                           type="checkbox"
                                           {% if geogebra.enableRightClick or not geogebra %}checked{% endif %}/>
                                    <label for="enableRightClick" class="label-success"></label>
                                </div>
                            </td>
                            <td>enableRightClick</td>
                            <td>States whether right clicks should be handled by the applet. Setting this parameter to
                                "false" disables context menus, properties dialogs and right-click-zooming.
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Lukk</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="changeCategoryModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Endre kategorier</h4>
                </div>
                <div class="modal-body">
                    <ul class="list-group">
                        {% for category in categories %}
                            {% if category in task.category.all %}
                                <li class="list-group-item">
                                    {{ category }}
                                    <div class="material-switch pull-right">
                                        <input id="category{{ forloop.counter }}" name="{{ category }}"
                                               type="checkbox" onchange="changeCategory(this.name, this.checked)"
                                               checked/>
                                        <label for="category{{ forloop.counter }}" class="label-success"></label>
                                    </div>
                                </li>
                            {% else %}
                                <li class="list-group-item">
                                    {{ category }}
                                    <div class="material-switch pull-right" id="extraField">
                                        <input id="category{{ forloop.counter }}" name="{{ category }}"
                                               type="checkbox" onchange="changeCategory(this.name, this.checked)"/>
                                        <label for="category{{ forloop.counter }}" class="label-success"></label>
                                    </div>
                                </li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Lukk</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="addMultipleChocice" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-lg" role="document" style="width: 80vw;">
            <div class="modal-content">
                <div class="modal-header" style="background-color: whitesmoke">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h3 class="modal-title text-center" id="myModalLabel">Flervalgsspørsmål</h3> <h5
                        class="text-center">Velg alternativet som er korrekt</h5>
                </div>
                <div class="modal-body">
                    <div id="multipleChoiceWarning" class="alert alert-danger hidden">
                        <strong>Tomt alternativ!</strong> Oppgaven kan ikke ha tomme svaralternativ. Vennligst fyll ut
                        alle felter som vises.
                    </div>
                    {% if task.answertype == 2 %}
                        {% for multiplechoice in task.multiplechoicetask_set.all %}
                            <div id="MutipleChoice{{ forloop.counter }}" class="multiplechoice"
                                 data-id="{{ forloop.counter }}">
                                <div class="form-group">
                                    <label for="question{{ forloop.counter }}">Spørsmål:</label>
                                    <input type="text" class="form-control" id="question1"
                                           placeholder="Skriv inn spørsmålet" value="{{ multiplechoice.question }}">
                                </div>
                                <div class="row">
                                    <div id="choicesDiv{{ forloop.counter }}" class="col-md-10">
                                        {% for option in multiplechoice.multiplechoiceoption_set.all %}
                                            <label class="checkbox-inline"><input type="checkbox"
                                                                                  value="{{ forloop.parentloop.counter }}"
                                                                                  {% if option.correct %}checked{% endif %}>
                                                <input type="text"
                                                       placeholder="Alternativ 1"
                                                       value="{{ option.option }}"></label>
                                        {% endfor %}
                                    </div>
                                    <div class="col-md-2" id="choicesBtn{{ forloop.counter }}">
                                        <button class="btn btn-primary btn-sm border-radius"
                                                onclick="AddChoice({{ forloop.counter }})">
                                            Legg til alternativ
                                        </button>
                                        <button class="btn btn-danger btn-sm border-radius"
                                                onclick="RemoveChoice({{ forloop.counter }})">Fjern alternativ
                                        </button>
                                    </div>
                                </div>
                                <div id="radioOrCheck{{ forloop.counter }}" style="margin-top: 10px;" class="">
                                    <label class="radio-inline">
                                        <input type="radio" name="radio{{ forloop.counter }}" value="radio"
                                                {% if not multiplechoice.checkbox %}
                                               checked
                                                {% endif %}>Radio
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio" name="radio{{ forloop.counter }}" value="check"
                                                {% if multiplechoice.checkbox %}
                                               checked
                                                {% endif %}>Checkbox
                                    </label>
                                </div>
                            </div>
                            <hr>
                        {% endfor %}
                    {% else %}
                        <div id="MutipleChoice1" class="multiplechoice">
                            <div>
                                <div class="form-group">
                                    <label for="question1">Spørsmål:</label>
                                    <input type="text" class="form-control" id="question1"
                                           placeholder="Skriv inn spørsmålet">
                                </div>
                                <div class="row">
                                    <div id="choicesDiv1" class="col-md-10">
                                        <label class="checkbox-inline"><input type="checkbox" value="1"><input
                                                type="text"
                                                placeholder="Alternativ 1"></label>
                                        <label class="checkbox-inline"><input type="checkbox" value="1"><input
                                                type="text"
                                                placeholder="Alternativ 2"></label>
                                        <label class="checkbox-inline"><input type="checkbox" value="1"><input
                                                type="text"
                                                placeholder="Alternativ 3"></label>
                                    </div>
                                    <div class="col-md-2" id="choicesBtn1">
                                        <button class="btn btn-primary btn-sm border-radius" onclick="AddChoice(1)">
                                            Legg til alternativ
                                        </button>
                                        <button class="btn btn-danger btn-sm border-radius"
                                                onclick="RemoveChoice(1)">Fjern alternativ
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div id="radioOrCheck1" style="margin-top: 10px;" class="hidden">
                                <label class="radio-inline">
                                    <input type="radio" name="radio1" value="radio" checked>Radio
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="radio1" value="check">Checkbox
                                </label>
                            </div>
                            <hr>
                        </div>
                    {% endif %}

                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="AddQuestion()">Legg til flere spørsmål</button>
                    <button class="btn btn-danger" onclick="RemoveQuestion()" id="removeQuestionBtn"
                            disabled="disabled">Fjern spørsmål
                    </button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Lukk</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="addInputModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-lg" role="document" style="width: 80%;">
            <div class="modal-content">
                <div class="modal-header" style="background-color: whitesmoke">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h3 class="modal-title text-center" id="myModalLabel">Legg til inputfelter</h3>
                </div>
                <div class="modal-body">
                    {% if task.answertype == 4 %}
                        {% get_inputfields task as inputfields %}
                        {% for inputtask in inputfields %}
                            <div id="input{{ forloop.counter }}" class="inputs">
                                <div id="inputFields{{ forloop.counter }}">
                                    <form>
                                        <div class="form-group">
                                            <label for="inputText1">Deloppgave:</label>
                                            <input type="text" class="form-control" id="inputText{{ forloop.counter }}"
                                                   placeholder="Oppgave"
                                                   value="{{ inputtask.question }}">
                                        </div>
                                    </form>
                                    {% for input in inputtask.inputfield_set.all %}
                                        <div class="col-md-12 inputrow{{ forloop.parentloop.counter }}">
                                            <div class="col-md-4">
                                                <form class="form-inline inputform{{ forloop.parentloop.counter }}">
                                                    <div class="form-group">
                                                        <input type="text" placeholder="Titel for inputfelt"
                                                               class="form-control" value="{{ input.title }}">
                                                        <strong> : </strong>
                                                        <input type="number" class="form-control">
                                                    </div>
                                                </form>
                                            </div>
                                            <div class="col-md-2 pull-right answerform{{ forloop.parentloop.counter }}">
                                                <input type="number" class="form-control"
                                                       {% if input.correct %}value="{{ input.correct }}"{% endif %}
                                                       placeholder="Skriv inn rett svar">
                                            </div>
                                            <div class="col-md-2 pull-right selectform{{ forloop.parentloop.counter }}">
                                                <div class="form-group">
                                                    <select class="form-control">
                                                        <option value="10" disabled selected>Lengden av inputfeltet
                                                        </option>
                                                        {% for x in "xxxxxxxxxx" %}
                                                            {% if input.inputlength == forloop.counter %}
                                                                <option value="{{ forloop.counter }}"
                                                                        selected>{{ forloop.counter }}</option>
                                                            {% else %}
                                                                <option value="{{ forloop.counter }}">{{ forloop.counter }}</option>
                                                            {% endif %}
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-2 pull-right fractionform{{ forloop.parentloop.counter }}">
                                                <button class="btn btn-primary pull-right {% if input.fraction %}fraction{% endif %}"
                                                        style="margin-right: 5px"
                                                        value="0"
                                                        onclick="addFractionLine(this)">Legg til
                                                    brøkstrek
                                                </button>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                                <div style="padding-top: 10px">
                                    <button class="btn btn-primary btn-sm"
                                            onclick="addInputField({{ forloop.counter }})">
                                        Legg til flere
                                        inputfelt
                                    </button>
                                    <button class="btn btn-danger btn-sm"
                                            onclick="removeInputField({{ forloop.counter }})"
                                            id="removeInputBtn{{ forloop.counter }}"
                                            {% if inputtask.inputfield_set.count < 2 %}disabled="disabled"{% endif %}>
                                        Fjern inputfelt
                                    </button>
                                </div>
                                <hr>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div id="input1" class="inputs">
                            <div id="inputFields1">
                                <form>
                                    <div class="form-group">
                                        <label for="inputText1">Deloppgave:</label>
                                        <input type="text" class="form-control" id="inputText1" placeholder="Oppgave">
                                    </div>
                                </form>
                                <div class="col-md-12 inputrow1">
                                    <div class="col-md-4">
                                        <form class="form-inline inputform1">
                                            <div class="form-group">
                                                <input type="text" placeholder="Titel for inputfelt"
                                                       class="form-control">
                                                <strong> : </strong>
                                                <input type="number" class="form-control">
                                            </div>
                                        </form>
                                    </div>
                                    <div class="col-md-2 pull-right answerform1">
                                        <input type="number" class="form-control" placeholder="Skriv inn rett svar">
                                    </div>
                                    <div class="col-md-2 pull-right selectform1">
                                        <div class="form-group">
                                            <select class="form-control">
                                                <option value="10" disabled selected>Lengden av inputfeltet</option>
                                                {% for x in "xxxxxxxxxx" %}
                                                    <option value="{{ forloop.counter }}">{{ forloop.counter }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-2 pull-right fractionform1">
                                        <button class="btn btn-primary pull-right" style="margin-right: 5px" value="0"
                                                onclick="addFractionLine(this)">Legg til
                                            brøkstrek
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 10px">
                                <button class="btn btn-primary btn-sm" onclick="addInputField(1)">Legg til flere
                                    inputfelt
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="removeInputField(1)" id="removeInputBtn1"
                                        disabled="disabled">Fjern inputfelt
                                </button>
                            </div>
                        </div>
                        <hr>
                    {% endif %}
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="addInput()">Legg til flere deloppgaver</button>
                    <button class="btn btn-danger" onclick="removeInput()" id="removeInputBtn"
                            {% if task.answertype == 4 %}{% if inputfields.count < 2 %}disabled="disabled"{% endif %}{% else %}disabled="disabled"{% endif %}>
                        Fjern deloppgave
                    </button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Lukk</button>
                </div>
            </div>
        </div>
    </div>
    <script>

        $(document).ready(function () {
            $('.multiplechoice').each(function () {
                var options = $("#MutipleChoice" + $(this).data('id') + " :checkbox:checked");
                if (options.length == 1) {
                    $('#radioOrCheck' + $(this).data('id')).removeClass('hidden');
                } else {
                    $('#radioOrCheck' + $(this).data('id')).addClass('hidden');
                }
            });
        });

        $(document).on('change', '.multiplechoice :checkbox', function () {
            var options = $("#MutipleChoice" + $(this).val() + " :checkbox:checked");
            if (options.length == 1) {
                $('#radioOrCheck' + $(this).val()).removeClass('hidden');
            } else {
                $('#radioOrCheck' + $(this).val()).addClass('hidden');
            }


        });

        /**
         * This function adds and removes categories in the view when the user has changed the
         * selected categories for the task.
         * @param category
         * @param check
         */
        function changeCategory(category, check) {
            if (check == true) {
                document.getElementById('categorydiv').innerHTML += '<span class="label label-info" style="margin-left: 1px" id="list' + category + '">' + category + '</span>';
            }
            else {
                $('#list' + category).remove();
            }
        }

        $('.settings').change(function (e) {
            $('#id_' + e.target.id).click();
        });

    </script>
{% endblock %}