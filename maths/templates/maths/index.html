{% extends 'matistikk/base.html' %}
{% load customtags %}
{% block head %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.min.js"></script>
{% endblock %}
{% block body %}
    <!-- Source http://codepen.io/rudyvalencia/details/JmowD. The admin panel is inspired by this codepen.-->
    <style>
        .circle-tile {
            margin-bottom: 15px;
            text-align: center;
        }

        .circle-tile-heading {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 100%;
            color: #FFFFFF;
            height: 80px;
            margin: 0 auto -40px;
            position: relative;
            transition: all 0.3s ease-in-out 0s;
            width: 80px;
        }

        .circle-tile-heading .fa {
            line-height: 80px;
        }

        .circle-tile-content {
            padding-top: 50px;
        }

        .circle-tile-number {
            font-size: 26px;
            font-weight: 700;
            line-height: 1;
            padding: 5px 0 15px;
        }

        .circle-tile-description {
            text-transform: uppercase;
        }

        .circle-tile-heading.dark-blue:hover {
            background-color: #0e84b5;
        }

        .dark-blue {
            background-color: #34495E;
        }

        .text-faded {
            color: rgba(255, 255, 255, 0.7);
        }
    </style>

    {% if request.user.role == 4 %}
        <!-- Super User Dashboard -->
        <div class="row">
            <div class="col-sm-12">
                <div class="col-sm-2">
                    <div class="circle-tile ">
                        <a href="{% url 'administration:personList' %}">
                            <div class="circle-tile-heading dark-blue"><i class="fa fa-user fa-fw fa-3x"></i></div>
                        </a>
                        <div class="circle-tile-content dark-blue">
                            <div class="circle-tile-description text-faded"> Antall Brukere</div>
                            <div class="circle-tile-number text-faded ">{{ users }}</div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-2">
                    <div class="circle-tile ">
                        <a href="{% url 'administration:schoolList' %}">
                            <div class="circle-tile-heading dark-blue"><i class="fa fa-home fa-fw fa-3x"></i></div>
                        </a>
                        <div class="circle-tile-content dark-blue">
                            <div class="circle-tile-description text-faded"> Antall Skoler</div>
                            <div class="circle-tile-number text-faded ">{{ schools }}</div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-2">
                    <div class="circle-tile ">
                        <a href="{% url 'administration:schoolList' %}">
                            <div class="circle-tile-heading dark-blue"><i class="fa fa-graduation-cap fa-fw fa-3x"></i>
                            </div>
                        </a>
                        <div class="circle-tile-content dark-blue">
                            <div class="circle-tile-description text-faded"> Antall Klasser</div>
                            <div class="circle-tile-number text-faded ">{{ grades }}</div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-2">
                    <div class="circle-tile ">
                        <a href="{% url 'administration:groupList' %}">
                            <div class="circle-tile-heading dark-blue"><i class="fa fa-users fa-fw fa-3x"></i></div>
                        </a>
                        <div class="circle-tile-content dark-blue">
                            <div class="circle-tile-description text-faded"> Antall Grupper</div>
                            <div class="circle-tile-number text-faded ">{{ groups }}</div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-2">
                    <div class="circle-tile ">
                        <a href="{% url 'maths:taskList' %}">
                            <div class="circle-tile-heading dark-blue"><i class="fa fa-pencil fa-fw fa-3x"></i></div>
                        </a>
                        <div class="circle-tile-content dark-blue">
                            <div class="circle-tile-description text-faded"> Antall Svar</div>
                            <div class="circle-tile-number text-faded ">{{ answers }}</div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-2">
                    <div class="circle-tile ">
                        <a href="{% url 'maths:taskCollectionList' %}">
                            <div class="circle-tile-heading dark-blue"><i class="fa fa-tasks fa-fw fa-3x"></i></div>
                        </a>
                        <div class="circle-tile-content dark-blue">
                            <div class="circle-tile-description text-faded"> Antall Tester</div>
                            <div class="circle-tile-number text-faded ">{{ tests }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-sm-12">
                <div class="col-xs-2">
                    <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                        <div class="panel panel-primary">
                            <div class="panel-heading box" style="background-color: #34495E" role="tab" id="headingOne"
                                 data-toggle="collapse"
                                 data-parent="#accordion" href="#collapseOne"
                                 aria-expanded="true" aria-controls="collapseOne">
                                <h4 class="panel-title">
                                    <a role="button">
                                        <i class="fa fa-user fa-fw"></i> Brukere <i class="fa fa-arrow-right pull-right"
                                                                                    aria-hidden="true"
                                                                                    id="arrowOne"></i>
                                    </a>
                                </h4>
                            </div>
                            <div id="collapseOne" class="panel-collapse collapse" role="tabpanel"
                                 aria-labelledby="headingOne">
                                <div class="panel-body">
                                    <ul class="nav nav-pills nav-stacked">
                                        <li role="presentation"><a href="{% url 'administration:personList' %}">Se
                                            brukeroversikt</a></li>
                                        <li role="presentation"><a href="{% url 'administration:personCreate' %}">Legg
                                            til bruker</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="panel panel-primary">
                            <div class="panel-heading box" style="background-color: #34495E" role="tab" id="headingTwo"
                                 data-toggle="collapse"
                                 data-parent="#accordion"
                                 href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                <h4 class="panel-title">
                                    <a class="collapsed" role="button">
                                        <i class="fa fa-pencil fa-fw"></i> Oppgaver <i
                                            class="fa fa-arrow-right pull-right" aria-hidden="true" id="arrowTwo"></i>
                                    </a>
                                </h4>
                            </div>
                            <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel"
                                 aria-labelledby="headingTwo">
                                <div class="panel-body">
                                    <ul class="nav nav-pills nav-stacked">
                                        <li role="presentation"><a href="{% url 'maths:taskList' %}">Se
                                            oppgaveoversikt</a></li>
                                        <li role="presentation"><a href="{% url 'maths:createTask' %}">Opprett ny
                                            oppgave</a></li>
                                        <li role="presentation"><a href="{% url 'maths:categoryList' %}">Se
                                            kategorier</a></li>
                                        <li role="presentation"><a href="{% url 'maths:categoryCreate' %}">Opprett ny
                                            kategori</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="panel panel-primary">
                            <div class="panel-heading box" style="background-color: #34495E" role="tab"
                                 id="headingThree" data-toggle="collapse"
                                 data-parent="#accordion"
                                 href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                <h4 class="panel-title">
                                    <a class="collapsed" role="button">
                                        <i class="fa fa-tasks fa-fw"></i> Tester <i class="fa fa-arrow-right pull-right"
                                                                                    aria-hidden="true"
                                                                                    id="arrowThree"></i>
                                    </a>
                                </h4>
                            </div>
                            <div id="collapseThree" class="panel-collapse collapse" role="tabpanel"
                                 aria-labelledby="headingThree">
                                <div class="panel-body">
                                    <ul class="nav nav-pills nav-stacked">
                                        <li role="presentation"><a href="{% url 'maths:taskCollectionList' %}">Se
                                            testoversikt</a></li>
                                        <li role="presentation"><a href="{% url 'maths:taskCollectionCreate' %}">Opprett
                                            ny test</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="panel panel-primary">
                            <div class="panel-heading box" style="background-color: #34495E" role="tab" id="headingFour"
                                 data-toggle="collapse"
                                 data-parent="#accordion"
                                 href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                <h4 class="panel-title">
                                    <a class="collapsed" role="button">
                                        <i class="fa fa-home fa-fw"></i> Skoler <i class="fa fa-arrow-right pull-right"
                                                                                   aria-hidden="true"
                                                                                   id="arrowFour"></i>
                                    </a>
                                </h4>
                            </div>
                            <div id="collapseFour" class="panel-collapse collapse" role="tabpanel"
                                 aria-labelledby="headingFour">
                                <div class="panel-body">
                                    <ul class="nav nav-pills nav-stacked">
                                        <li role="presentation"><a href="{% url 'administration:schoolList' %}">Se
                                            skoleoversikt</a></li>
                                        <li role="presentation"><a href="{% url 'administration:schoolCreate' %}">Opprett
                                            ny skole</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="panel panel-primary">
                            <div class="panel-heading box" style="background-color: #34495E" role="tab" id="headingFive"
                                 data-toggle="collapse"
                                 data-parent="#accordion"
                                 href="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
                                <h4 class="panel-title">
                                    <a class="collapsed" role="button">
                                        <i class="fa fa-users fa-fw"></i> Grupper <i
                                            class="fa fa-arrow-right pull-right" aria-hidden="true" id="arrowFive"></i>
                                    </a>
                                </h4>
                            </div>
                            <div id="collapseFive" class="panel-collapse collapse" role="tabpanel"
                                 aria-labelledby="headingFive">
                                <div class="panel-body">
                                    <ul class="nav nav-pills nav-stacked">
                                        <li role="presentation"><a href="{% url 'administration:groupList' %}">Se
                                            gruppeoversikt</a></li>
                                        <li role="presentation"><a href="{% url 'administration:groupCreate' %}">Opprett
                                            ny gruppe</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-5">
                    <div class="panel panel-info" style="border-right: 1px solid">
                        <div class="panel-heading">
                            <h4>Siste Publiserte Tester</h4>
                        </div>
                        <div class="panel-body">
                            <table class="table table-hover table-striped table-responsive">
                                <thead>
                                <tr>
                                    <th>Dato</th>
                                    <th>Test</th>
                                    <th>Laget av</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for test in lasttests %}
                                    <tr class="clickable-row" data-href="{% url 'maths:testDetail' test.id %}"
                                        style="cursor: pointer">
                                        <td>{{ test.published }}</td>
                                        <td>{{ test }}</td>
                                        <td>{{ test.task_collection.author.first_name }} {{ test.task_collection.author.last_name }}</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-sm-5">
                    <div class="panel panel-info">
                        <div class="panel-heading">
                            <h4>Siste Besvarte Tester</h4>
                        </div>
                        <div class="panel-body">
                            <table class="table table-hover table-striped table-responsive">
                                <thead>
                                <tr>
                                    <th>Dato</th>
                                    <th>Test</th>
                                    <th>Besvart av</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for answer in lastanswers %}
                                    <tr class="clickable-answer"
                                        data-href="{% url 'maths:answerDetail' test_pk=answer.test.id slug=answer.user.username %}"
                                        style="cursor: pointer">
                                        <td>{{ answer.date_answered }}</td>
                                        <td>{{ answer.test }}</td>
                                        <td>{{ answer.user }}</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    {% elif request.user.role == 3 %}
        <!-- School Administrator User Dashboard -->
        <div class="row">
            <div class="col-sm-6">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <h4>Brukere</h4>
                    </div>
                    <div class="panel-body">
                        <table class="table table-hover table-striped table-responsive">
                            <thead>
                            <tr>
                                <th>Navn</th>
                                <th>Brukernavn</th>
                                <th>Brukertype</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for person in persons %}
                                <tr class="clickable-row"
                                    data-href="{% url 'administration:personDetail' person.username %}"
                                    style="cursor: pointer">
                                    <td>{{ person.first_name }} {{ person.last_name }}</td>
                                    <td>{{ person.username }}</td>
                                    <td>
                                        {% if person.role == 1 %}
                                            Elev
                                        {% elif person.role == 2 %}
                                            Lærer
                                        {% elif person.role == 3 %}
                                            Skoleadministrator
                                        {% elif person.role == 4 %}
                                            Superbruker
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <h4>Skoler</h4>
                    </div>
                    <div class="panel-body">
                        {% for school in schools %}
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h4>{{ school.school_name }}</h4>
                                </div>
                                <div class="panel-body">
                                    <table class="table table-hover table-striped table-responsive">
                                        <tbody>
                                        {% for grade in grades %}
                                            <tr class="clickable-row"
                                                data-href="{% url 'administration:gradeDetail' school.id grade.id %}"
                                                style="cursor: pointer">
                                                {% if grade.school == school %}
                                                    <td>{{ grade.grade_name }}</td>
                                                {% endif %}
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

    {% elif request.user.role == 2 %}
        <div class="row">
            <div class="col-sm-6">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <h4>Tilgjengelige tester ({{ tests|length }})</h4>
                    </div>
                    <div class="panel-body">
                        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true"
                             style="max-height: 75vh; overflow: auto">
                            {% for test in tests %}
                                <div id="panel{{ forloop.counter }}" class="panel panel-default">
                                    <div class="panel-heading box" role="tab" id="heading{{ forloop.counter }}"
                                         data-toggle="collapse" data-parent="#accordion"
                                         href="#collapse{{ forloop.counter }}" style="cursor: pointer">
                                        <h4 class="panel-title">
                                            <a role="button"
                                               aria-expanded="true" aria-controls="collapse{{ forloop.counter }}">
                                                {{ test }}
                                                <p id="testpanel{{ forloop.counter }}" class="pull-right"></p>
                                                <input id="date{{ forloop.counter }}" type="datetime"
                                                       value="{{ test.dueDate.isoformat }}" hidden>
                                            </a>
                                        </h4>
                                    </div>
                                    <div id="collapse{{ forloop.counter }}" class="panel-collapse collapse"
                                         role="tabpanel"
                                         aria-labelledby="heading{{ forloop.counter }}">
                                        <div class="panel-body">
                                            <div class="row">
                                                <div class="col-sm-6">
                                                    <p><strong>Starttidspunkt: </strong>{{ test.published }}</p>
                                                    <span id="publishdate{{ forloop.counter }}"
                                                          hidden>{{ test.published.isoformat }}</span>
                                                    <p><strong>Frist: </strong>{% if test.dueDate %}
                                                        {{ test.dueDate }}{% else %}Ingen{% endif %}</p>
                                                    <p><strong>Rekkefølge: </strong> {% if test.randomOrder %}
                                                        Tilfeldig {% endif %}
                                                        {% if test.randomOrder and test.strictOrder %}
                                                            og {% endif %}
                                                        {% if test.strictOrder %}Låst{% endif %}</p>
                                                    <p><strong>Antall
                                                        Oppgaver: </strong>{{ test.task_collection.tasks.count }}</p>
                                                    <p><strong>Laget
                                                        av: </strong>{{ test.task_collection.author.first_name }} {{ test.task_collection.author.last_name }}
                                                    </p>
                                                </div>
                                                <div class="col-sm-6">
                                                    <button id="publishBtn{{ forloop.counter }}" value="{{ test.id }}"
                                                            type="button" class="btn btn-info publish pull-right"
                                                            onclick="publish(this)">
                                                        <i class="fa fa-book" aria-hidden="true"></i> Publisering
                                                    </button>
                                                    <a type="button" href='{% url 'maths:answerCreate' test.id %}'
                                                       class="btn btn-info pull-right">
                                                        <i class="fa fa-tasks" aria-hidden="true"></i> Se test
                                                    </a>

                                                    <a type="button" href='{% url "maths:testDetail" test.id %}'
                                                       class="btn btn-info pull-right"><span
                                                            class="glyphicon glyphicon-eye-open"></span> Se besvarelser
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <h4>Siste Besvarte Tester</h4>
                    </div>
                    <div class="panel-body">
                        <table class="table table-hover table-striped table-responsive">
                            <thead>
                            <tr>
                                <th>Dato</th>
                                <th>Test</th>
                                <th>Besvart av</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for answer in lastanswers %}
                                <tr class="clickable-answer"
                                    data-href="{% url 'maths:answerDetail' test_pk=answer.test.id slug=answer.user.username %}"
                                    style="cursor: pointer">
                                    <td>{{ answer.date_answered }}</td>
                                    <td>{{ answer.test }}</td>
                                    <td>{{ answer.user }}</td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>


    {% elif request.user.role == 1 %}
        <!-- Student Dashboard -->
        <div class="row">
            <div class="col-sm-6">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <h4>Tilgjengelige tester ({{ notanswered|length }})</h4>
                    </div>
                    <div class="panel-body">
                        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true"
                             style="max-height: 75vh; overflow: auto">
                            {% for test in notanswered %}
                                <div id="panel{{ forloop.counter }}" class="panel panel-default">
                                    <div class="panel-heading box" role="tab" id="heading{{ forloop.counter }}"
                                         data-toggle="collapse" data-parent="#accordion"
                                         href="#collapse{{ forloop.counter }}" style="cursor: pointer">
                                        <h4 class="panel-title">
                                            <a role="button"
                                               aria-expanded="true" aria-controls="collapse{{ forloop.counter }}" id="{{ test.task_collection.test_name }}">
                                                {{ test }}
                                                <p id="testpanel{{ forloop.counter }}" class="pull-right"></p>
                                                <input id="date{{ forloop.counter }}" type="datetime"
                                                       value="{{ test.dueDate.isoformat }}" hidden>
                                            </a>
                                        </h4>
                                    </div>
                                    <div id="collapse{{ forloop.counter }}" class="panel-collapse collapse"
                                         role="tabpanel"
                                         aria-labelledby="heading{{ forloop.counter }}">
                                        <div class="panel-body">
                                            <div class="row">
                                                <div class="col-sm-6">
                                                    <p><strong>Starttidspunkt: </strong>{{ test.published }}</p>
                                                    <span id="publishdate{{ forloop.counter }}"
                                                          hidden>{{ test.published.isoformat }}</span>
                                                    <p><strong>Frist: </strong>{% if test.dueDate %}
                                                        {{ test.dueDate }}{% else %}Ingen Frist.{% endif %}</p>
                                                    <p><strong>Antall
                                                        Oppgaver: </strong>{{ test.task_collection.tasks.count }}</p>
                                                    <p><strong>Laget
                                                        av: </strong>{{ test.task_collection.author.first_name }} {{ test.task_collection.author.last_name }}
                                                    </p>
                                                </div>
                                                <div class="col-sm-6">
                                                    <span id="testinfo{{ forloop.counter }}"></span>
                                                    <a id="starttestbutton{{ forloop.counter }}" type="button"
                                                       class="btn btn-success btn-lg pull-right"
                                                       href="{% url 'maths:answerCreate' test.id %}">Start Aktivitet
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="panel panel-success" style="border-left: 1px solid">
                    <div class="panel-heading">
                        <h4>Gjennomførte aktiviteter</h4>
                    </div>
                    <div class="panel-body">
                        <div class="panel-group" id="accordion2" role="tablist" aria-multiselectable="true"
                             style="max-height: 75vh; overflow: auto">
                            {% for test in answered %}
                                <div id="donepanel{{ forloop.counter }}" class="panel panel-default">
                                    <div class="panel-heading box" role="tab" id="doneheading{{ forloop.counter }}"
                                         data-toggle="collapse" data-parent="#accordion2" style="cursor:pointer;"
                                         href="#donecollapse{{ forloop.counter }}">
                                        <h4 class="panel-title">
                                            <a role="button"
                                               aria-expanded="true" aria-controls="donecollapse{{ forloop.counter }}" id="{{test.task_collection.test_name }}">
                                                {{ test }}
                                            </a>
                                        </h4>
                                    </div>
                                    <div id="donecollapse{{ forloop.counter }}" class="panel-collapse collapse"
                                         role="tabpanel"
                                         aria-labelledby="doneheading{{ forloop.counter }}">
                                        <div class="panel-body">
                                            <div class="row">
                                                <div class="col-sm-6">
                                                    <p><strong>Starttidspunkt: </strong>{{ test.published }}</p>
                                                    <span id="publishdate{{ forloop.counter }}"
                                                          hidden>{{ test.published.isoformat }}</span>
                                                    <p><strong>Frist: </strong>{% if test.dueDate %}
                                                        {{ test.dueDate }}{% else %}Ingen Frist.{% endif %}</p>
                                                    {% get_answered test request.user.username as answer %}
                                                    <p>
                                                        <strong>Besvart: </strong> {{ answer.date_answered }}
                                                    </p>
                                                    <p><strong>Antall
                                                        Oppgaver: </strong>{{ test.task_collection.tasks.count }}</p>
                                                    <p><strong>Laget
                                                        av: </strong>{{ test.task_collection.author.first_name }} {{ test.task_collection.author.last_name }}
                                                    </p>
                                                </div>
                                                <div class="col-sm-6">
                                                    <a id="seetestbutton{{ forloop.counter }}" type="button"
                                                       class="btn btn-success btn-lg pull-right"
                                                       href="{% url 'maths:answerDetail' test.id request.user.username %}">Se
                                                        Besvarelse
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

    <script>
        /**
         * Function that runs when the page is fully loaded. Calculates the time left to the duedate on the available
         * tasks.
         */
        window.onload = function () {
            var inputs = document.getElementById('accordion').getElementsByTagName('input');

            for (var i = 0; i < inputs.length; i++) {
                var duedate = new Date(document.getElementById('date' + (i + 1)).value);
                var publishdate = new Date(document.getElementById('publishdate' + (i + 1)).innerHTML);
                if (publishdate > Date.now()) {
                    $('#starttestbutton' + (i + 1)).hide();
                    $('#testinfo' + (i + 1)).append('<div class="alert alert-info" role="alert"><strong>Testen har ikke startet enda!</strong> Du kan starte denne testen når starttidspunktet er passert.</div>');
                }

                if (!(isNaN(duedate))) {
                    var datenow = Date.now();
                    var sjekk = duedate - datenow;
                    var diff = Math.abs(duedate - datenow) / 1000;
                    if (sjekk > 0) {
                        var days = Math.floor(diff / 86400);
                        diff -= days * 86400;
                        var hours = Math.floor(diff / 3600) % 24;
                        diff -= hours * 3600;
                        var minutes = Math.floor(diff / 60) % 60;
                        if (days > 0) {
                            $('#testpanel' + (i + 1)).append(days + ' dager, ' + hours + ' timer, ' + minutes + ' min');
                        }
                        else {
                            $('#testpanel' + (i + 1)).append(days + ' dager, ' + hours + ' timer, ' + minutes + ' min');
                            $('#panel' + (i + 1)).removeClass('panel panel-default').addClass('panel panel-warning');
                        }
                    }
                    else {
                        $('#testpanel' + (i + 1)).append('Tidsfristen er ute');
                        $('#publishBtn' + (i + 1)).attr('disabled', 'disabled');
                        $('#panel' + (i + 1)).removeClass('panel panel-default').addClass('panel panel-danger');
                        $('#testinfo' + (i + 1)).append('<div class="alert alert-danger" role="alert"><strong>Tidsfristen er ute!</strong> Du kan fortsatt ta testen, men den vil bli markert som levert for sent.</div>');
                    }
                }
                else {
                    $('#testpanel' + (i + 1)).append('Ingen tidsfrist');
                }
            }

        };


        jQuery(document).ready(function ($) {
            /**
             * This function makes the rows of the user-, student-, teacher- and admintable clickable
             */
            $(".clickable-row").click(function () {
                window.document.location = $(this).data("href");
            });
            /**
             * Function that opens a modal and gives the user a choice to go to the answer of the clicked task.
             */
            $(".clickable-answer").click(function () {
                var url = $(this).data("href");
                var row = $(this);
                row.addClass('info');
                bootbox.confirm({
                    size: "medium",
                    title: "Gå til besvarelse?",
                    message: "Dette fører deg direkte til besvarelsen av denne oppgaven.",
                    backdrop: true,
                    buttons: {
                        cancel: {
                            label: '<i class="fa fa-times"></i> Avbryt'
                        },
                        confirm: {
                            label: '<i class="fa fa-check"></i> ' + "Gå til besvarelse",
                            className: 'btn-success'
                        }
                    },
                    callback: function (result) {
                        if (result) {
                            window.document.location = url;
                        } else {
                            row.removeClass('info')
                        }
                    }
                });
            })
        });
        /**
         * Function that redirects the user to the publish test view. Only for teachers.
         */
        function publish(btn) {
            var testID = btn.value;
            var username = "{{ request.user.username }}";
            var publishURL = "{% url 'maths:testListPublish' slug=1234 test_pk=5678 %}".replace(/1234/, username).replace(/5678/, testID);
            window.document.location = publishURL;

        }
        /**
         * Functions that changes the arrows from pointing right to down when div not collapsed.
         */
        $('#collapseOne').on('show.bs.collapse', function () {
            $('#arrowOne').removeClass().addClass('fa fa-arrow-down pull-right');
        });
        $('#collapseOne').on('hide.bs.collapse', function () {
            $('#arrowOne').removeClass().addClass('fa fa-arrow-right pull-right');
        });
        $('#collapseTwo').on('show.bs.collapse', function () {
            $('#arrowTwo').removeClass().addClass('fa fa-arrow-down pull-right');
        });
        $('#collapseTwo').on('hide.bs.collapse', function () {
            $('#arrowTwo').removeClass().addClass('fa fa-arrow-right pull-right');
        });
        $('#collapseThree').on('show.bs.collapse', function () {
            $('#arrowThree').removeClass().addClass('fa fa-arrow-down pull-right');
        });
        $('#collapseThree').on('hide.bs.collapse', function () {
            $('#arrowThree').removeClass().addClass('fa fa-arrow-right pull-right');
        });
        $('#collapseFour').on('show.bs.collapse', function () {
            $('#arrowFour').removeClass().addClass('fa fa-arrow-down pull-right');
        });
        $('#collapseFour').on('hide.bs.collapse', function () {
            $('#arrowFour').removeClass().addClass('fa fa-arrow-right pull-right');
        });
        $('#collapseFive').on('show.bs.collapse', function () {
            $('#arrowFive').removeClass().addClass('fa fa-arrow-down pull-right');
        });
        $('#collapseFive').on('hide.bs.collapse', function () {
            $('#arrowFive').removeClass().addClass('fa fa-arrow-right pull-right');
        });
    </script>

{% endblock %}